!function(){var e=angular.module("eGestion",["ui.router.compat","headerController","actionsController","homeController","clientsController","productsController","familiesController","ordersController","loginController","configController","usersController","projectsController","expensesController","commaDirective","passwordCheck","chart.js","recursiveFamilies","inputEnable","setFocus","hitEnter","angularFileUpload","ngAnimate","dateConverterFilter","textAngular"]);e.config(["$httpProvider","$stateProvider","$urlRouterProvider","$locationProvider","$provide",function(e,t,r,n,o){e.defaults.useXDomain=!0,e.defaults.withCredentials=!0,delete e.defaults.headers.common["X-Requested-With"],e.interceptors.push(["$timeout","$q","$injector","$rootScope",function(e,t,r,n){var o,a,s;return e(function(){o=r.get("LoginService"),a=r.get("$http"),s=r.get("$state")}),{responseError:function(r){if(sessionStorage.removeItem("user"),sessionStorage.removeItem("userImg"),sessionStorage.removeItem("userID"),sessionStorage.removeItem("token"),sessionStorage.removeItem("userRol"),"login"==s.current.name&&(sessionStorage.loginModal=!0,"index"!=n.previousState.name&&(n.alerts=[{type:"danger",msg:"usuario o contraseña incorrectos."}],e(function(){delete n.alerts},4e4)),"index"==n.previousState.name&&(n.previousState.name="")),401!==r.status&&"login"!==s.current.name)return s.go("noAuth"),r;403===r.status&&"login"==s.current.name?(n.alerts=[{type:"danger",msg:"usuario o contraseña incorrectos."}],e(function(){delete n.alerts},4e4)):sessionStorage.removeItem("loginModal");var i=t.defer();return sessionStorage.loginModal===!1&&(sessionStorage.loginModal=!0,o.modal().then(function(){sessionStorage.removeItem("loginModal"),i.resolve(a(r.config))})["catch"](function(){sessionStorage.removeItem("loginModal"),s.go("login"),i.reject(r)})),i.promise}}}]),r.otherwise("/"),t.state("index",{url:"/",section:"parent",title:"App eGestion",views:{contentView:{templateUrl:"views/home.html",controller:"HomeController"}},data:{}}).state("login",{url:"login",section:"parent",title:"App eGestion",views:{contentView:{templateUrl:"views/login.html",controller:"LoginFormController"}},data:{}}).state("noAuth",{url:"acceso-restringido",section:"parent",title:"Acceso restringido",views:{contentView:{templateUrl:"views/403.html"}},data:{requireLogin:!1}}).state("familias",{url:"/categorias",title:"Categorías",section:"parent",views:{contentView:{templateUrl:"views/familias.html",controller:"FamiliesController"},subMenuView:{templateUrl:"partials/family-menu.html",controller:"FamiliesMenuController"}},data:{requireLogin:!0,authRoles:[1,2]}}).state("clientes",{url:"/clientes",title:"Clientes",section:"parent",views:{contentView:{templateUrl:"views/clientes.html",controller:"ClientsController"},subMenuView:{templateUrl:"partials/client-menu.html"}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("clientesDetalle",{url:"/clientes/:clientID",title:"Detalle de cliente",section:"parent",views:{contentView:{templateUrl:"views/cliente-detalle.html",controller:"DetailClientsController",resolve:{resolveClient:["ClientsService","$stateParams",function(e,t){var r=t.clientID;return e.getClient(r)}]}},subMenuView:{templateUrl:"partials/client-detail-menu.html",controller:"DetailClientsMenuController"}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("clientesCrear",{url:"/crear-cliente",section:"parent",title:"Añadir cliente",views:{contentView:{templateUrl:"views/cliente-crear.html",controller:"AddClientsController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("productosRootFamilias",{url:"/productos/:familyID?",section:"parent",title:"Productos",views:{contentView:{templateUrl:"views/categorias.html",controller:"ProductsRootFamiliesController"},subMenuView:{templateUrl:"partials/product-menu.html",controller:"ProductsRootFamiliesController"}},data:{requireLogin:!0,authRoles:[1,2,3]}}).state("productos",{url:"/listado-productos",section:"parent",title:"Productos",views:{contentView:{templateUrl:"views/producto-listado.html",controller:"ProductsListController"},subMenuView:{templateUrl:"partials/product-menu.html",controller:"ProductsListController"}},data:{requireLogin:!0,authRoles:[1,2,3]}}).state("productosListado",{url:"/producto/:familyName/:familyID",section:"parent",title:"Productos",views:{contentView:{templateUrl:"views/producto-listado.html",controller:"ProductsListController"},subMenuView:{templateUrl:"partials/product-menu.html",controller:"ProductsListController"}},data:{requireLogin:!0,authRoles:[1,2,3]}}).state("productoDetalle",{url:"/producto/:productID",section:"parent",title:"Detalle de producto",views:{contentView:{templateUrl:"views/producto-detalle.html",controller:"ProductsDetailController",resolve:{resolveProduct:["ProductsService","$stateParams",function(e,t){var r=t.productID;return e.getProduct(r)}],resolvePrice:["ProductsService","$stateParams",function(e,t){var r=t.productID;return e.getProductPrice(r)}],resolveProductImage:["ProductsService","$stateParams",function(e,t){var r=t.productID;return e.getProductImage(r)}]}}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("productosCrear",{url:"/crear-producto",section:"parent",title:"Crear producto",views:{contentView:{templateUrl:"views/producto-crear.html",controller:"AddProductsController"}},data:{requireLogin:!0,authRoles:[1,2]}}).state("pedidoCrear",{url:"/crear-pedido",section:"parent",title:"Crear pedido",views:{contentView:{templateUrl:"views/pedido-crear.html",controller:"MakeOrderController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("addProductosPedido",{url:"/crear-pedido/anadir-productos",section:"parent",title:"Pedido en curso",views:{contentView:{templateUrl:"views/pedido-add.html",controller:"OrderAddProductController"},subMenuView:{templateUrl:"partials/order-add-menu.html",controller:"OrderAddProductMenuController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("categoriasPedido",{url:"/crear-pedido/productos/:familyID?",section:"parent",title:"Pedido en curso",views:{contentView:{templateUrl:"views/pedido-categorias.html",controller:"OrderCategoryController"},subMenuView:{templateUrl:"partials/order-add-category-menu.html",controller:"OrderAddProductMenuController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("addCategoriasProductosPedido",{url:"/crear-pedido/producto/:familyName/:familyID",section:"parent",title:"Pedido en curso",views:{contentView:{templateUrl:"views/pedido-categorias-add.html",controller:"OrderAddProductController"},subMenuView:{templateUrl:"partials/order-add-category-menu.html",controller:"OrderAddProductMenuController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("resumenPedido",{url:"/resumen-pedido",section:"parent",title:"Finalizar pedido",views:{contentView:{templateUrl:"views/pedido-resumen.html",controller:"OrderResumeController"},subMenuView:{templateUrl:"partials/order-resume-menu.html",controller:"OrderResumeMenuController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("pedidoDetalle",{url:"/pedido/:orderID",section:"parent",title:"Detalle de pedido",views:{contentView:{templateUrl:"views/pedido-detalle.html",controller:"OrderDetailController"},subMenuView:{templateUrl:"partials/order-detail-menu.html",controller:"OrderDetailController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoPedidos",{url:"/pedidos/:clientID?",section:"parent",title:"Pedidos presentados",views:{contentView:{templateUrl:"views/pedido-listado.html",controller:"OrderListController"},subMenuView:{templateUrl:"partials/order-list-menu.html"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoPedidosAceptados",{url:"/pedidos-aceptados/:clientID?",section:"parent",title:"Pedidos aceptados",views:{contentView:{templateUrl:"views/pedido-listado.html",controller:"OrderListController"},subMenuView:{templateUrl:"partials/order-list-menu.html"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoFacturasClientes",{url:"/facturas/cliente/:clientID",section:"parent",title:"Facturas",views:{contentView:{templateUrl:"views/factura-listado.html",controller:"InvoiceListController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoFacturasPedidos",{url:"/facturas/pedido/:orderID",section:"parent",title:"Facturas",views:{contentView:{templateUrl:"views/factura-listado.html",controller:"InvoiceListController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoFacturas",{url:"/facturas/:type?",section:"parent",title:"Facturas",views:{contentView:{templateUrl:"views/factura-listado.html",controller:"InvoiceListController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("facturasDetalle",{url:"/factura/:invoiceID",title:"Detalle de factura",section:"parent",views:{contentView:{templateUrl:"views/factura-detalle.html",controller:"DetailInvoiceController"},subMenuView:{templateUrl:"partials/invoice-detail-menu.html",controller:"DetailInvoiceMenuController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoGastos",{url:"/gastos",section:"parent",title:"Gastos",views:{contentView:{templateUrl:"views/gastos-listado.html",controller:"ListExpensesController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("listadoGastosRecurrentes",{url:"/gastos-recurrentes",section:"parent",title:"Gastos Recurrentes",views:{contentView:{templateUrl:"views/gastos-listado.html",controller:"ListExpensesController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("insertarGastos",{url:"/gastos/insertar",section:"parent",title:"Insertar Gastos",views:{contentView:{templateUrl:"views/gastos-crear.html",controller:"AddExpensesController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("gastosDetalle",{url:"/gastos/:gastosID",title:"Detalle de gastos",section:"parent",views:{contentView:{templateUrl:"views/gastos-detalle.html",controller:"ListExpensesController",resolve:{resolveExpenses:["ExpensesService","$stateParams",function(e,t){var r=t.expensesID;return e.getExpenses(r)}]}}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("configuracion",{url:"/configuracion",title:"Configuracion",section:"parent",views:{contentView:{templateUrl:"views/configuracion.html",controller:"ConfigController"}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("usuarios",{url:"/usuarios",title:"usuarios",section:"parent",views:{contentView:{templateUrl:"views/usuarios.html",controller:"UsersController"},subMenuView:{templateUrl:"partials/user-menu.html"}},data:{requireLogin:!0,authRoles:[1]}}).state("usuariosDetalle",{url:"/usuarios/:userID",title:"Detalle de usuario",section:"parent",views:{contentView:{templateUrl:"views/usuario-detalle.html",controller:"DetailUsersController",resolve:{resolveUser:["UsersService","$stateParams",function(e,t){var r=t.userID;return e.getUser(r)}]}}},data:{requireLogin:!0,authRoles:[1]}}).state("usuariosCrear",{url:"/crear-usuario",section:"parent",title:"Crear usuario",views:{contentView:{templateUrl:"views/usuario-crear.html",controller:"AddUsersController"}},data:{requireLogin:!0,authRoles:[1]}}).state("usuario",{url:"/mi-perfil/:userID",title:"Detalle de usuario",section:"parent",views:{contentView:{templateUrl:"views/usuario-detalle.html",controller:"DetailUserController",resolve:{resolveUser:["UsersService","$stateParams",function(e,t){var r=t.userID;return e.getUser(r)}]}}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("proyectos",{url:"/proyectos/:clientID?",title:"Proyectos",section:"parent",views:{contentView:{templateUrl:"views/proyectos.html",controller:"ProjectsController"},subMenuView:{templateUrl:"partials/project-menu.html"}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("proyectoCrear",{url:"/crear-proyecto/:clientID?",section:"parent",title:"Crear proyecto",views:{contentView:{templateUrl:"views/proyecto-crear.html",controller:"AddProjectController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("proyectosDetalle",{url:"/proyecto/:projectID",title:"Detalle de proyecto",section:"parent",views:{contentView:{templateUrl:"views/proyecto-detalle.html",controller:"DetailProjectsController",resolve:{resolveProject:["ProjectsService","$stateParams",function(e,t){var r=t.projectID;return e.getProject(r)}]}},subMenuView:{templateUrl:"partials/project-detail-menu.html",controller:"DetailProjectsController",resolve:{resolveProject:["ProjectsService","$stateParams",function(e,t){var r=t.projectID;return e.getProject(r)}]}}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}).state("listadoTareas",{url:"/proyectos/:projectID/tareas/:userID?",section:"parent",title:"Tareas",views:{contentView:{templateUrl:"views/tareas-listado.html",controller:"TasksListController"},subMenuView:{templateUrl:"partials/task-menu.html",controller:"TasksListMenuController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("clienteTareas",{url:"/clientes/:clientID/tareas",section:"parent",title:"Tareas",views:{contentView:{templateUrl:"views/tareas-listado.html",controller:"TasksListController"},subMenuView:{templateUrl:"partials/task-menu.html",controller:"TasksListMenuController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("usuarioTareas",{url:"/mis-tareas",section:"parent",title:"Mis Tareas",views:{contentView:{templateUrl:"views/tareas-listado.html",controller:"TasksListController"}},data:{requireLogin:!0,authRoles:[1,3,4]}}).state("TareaCrear",{url:"/proyecto/:projectID/crear-tarea",section:"parent",title:"Crear tarea",views:{contentView:{templateUrl:"views/tarea-crear.html",controller:"AddTaskController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("TareaClientCrear",{url:"/clientes/:clientID/crear-tarea",section:"parent",title:"Crear tarea",views:{contentView:{templateUrl:"views/tarea-crear.html",controller:"AddTaskController"}},data:{requireLogin:!0,authRoles:[1,3]}}).state("tareaDetalle",{url:"/tareas/:taskID",title:"Detalle de tarea",section:"parent",views:{contentView:{templateUrl:"views/tarea-detalle.html",controller:"DetailTaskController",resolve:{resolveTask:["ProjectsService","$stateParams",function(e,t){var r=t.taskID;return e.getTask(r)}]}},subMenuView:{templateUrl:"partials/task-detail-menu.html",controller:"DetailTaskController",resolve:{resolveTask:["ProjectsService","$stateParams",function(e,t){var r=t.taskID;return e.getTask(r)}]}}},data:{requireLogin:!0,authRoles:[1,2,3,4]}}),o.decorator("$browser",["$delegate",function(e){var t=e.url;return e.url=function(e,r){return void 0!==e?t(e.replace(/\%20/g,"+"),r):t().replace(/\+/g,"%20")},e}]),n.html5Mode(!0)}]),e.constant("config",{domain:"http://app.fiadeiro.es/",imagePath:"/upload",itemsPerPage:10,maxPages:6}),e.run(["$state","$rootScope","LoginService","$injector","$http",function(e,t,r,n,o){t.section="parent",localStorage.appDefaultView||(localStorage.appDefaultView="list"),localStorage.appProductMode||(localStorage.appProductMode="byCategory"),t.$on("$stateChangeSuccess",function(e,r,n){t.title=r.title,t.section=r.section}),sessionStorage.removeItem("loginModal"),sessionStorage.user&&!t.currentUser&&(t.currentUser=sessionStorage.user),sessionStorage.userImg&&!t.currentUserImg&&(t.currentUserImg=sessionStorage.userImg),sessionStorage.userID&&!t.currentUserID&&(t.currentUserID=sessionStorage.userID),sessionStorage.token&&!t.token&&(t.token=sessionStorage.token),sessionStorage.userRol&&!t.userRol&&(t.userRol=sessionStorage.userRol),t.$on("$stateChangeStart",function(n,a,s,i){t.previousState=i,o.defaults.headers.common.Token=t.token;var c=a.data.requireLogin,l=function(e){return"0"===e?1:a.data.authRoles.indexOf(parseInt(e))};c&&"undefined"==typeof t.currentUser&&(n.preventDefault(),r.modal().then(function(){return e.go(a.name,s)})["catch"](function(){return e.go("login")})),c&&"undefined"!=typeof t.currentUser&&l(t.userRol)<0&&(n.preventDefault(),e.go("noAuth"))})}]),Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)}}(),function(){var e=angular.module("actionsController",[]);e.controller("ActionsController",["$scope","$window",function(e,t){e.goBack=function(){t.history.back()},e.isFull=!0,e.toggleMenu=function(){e.isFull=!e.isFull}}])}(),function(){var e=angular.module("headerController",[]);e.controller("HeaderController",["$scope","$rootScope","$window","$state",function(e,t,r,n){e.userHidden=!0,e.toggleUserMenu=function(){e.userHidden=!e.userHidden},e.logOut=function(){delete t.currentUser,delete t.token,delete t.userRol,delete t.currentuserID,sessionStorage.removeItem("user"),sessionStorage.removeItem("userID"),sessionStorage.removeItem("token"),sessionStorage.removeItem("userRol"),n.go("login")},e.hideUserMenu=function(){e.userHidden===!1&&(e.userHidden=!0)},t.$watch("token",function(){t.currentUser&&t.token?e.showUserMenu=!0:e.showUserMenu=!1})}]),e.controller("NavController",["$scope","$state",function(e,t){e.menu=[{name:"Clientes",href:"#",icon:"users",subItems:[{name:"Clientes",href:"clientes"},{name:"Crear Cliente",href:"clientesCrear"}],activeMenu:["clientes","clientesCrear"]},{name:"Proyectos",href:"#",icon:"folder-open",subItems:[{name:"Proyectos",href:"proyectos"},{name:"Crear proyecto",href:"proyectoCrear"}],activeMenu:["proyectos","proyectoCrear"]},{name:"Facturación",href:"#",icon:"euro",subItems:[{name:"Facturas pendientes",href:"listadoFacturas({clientID:'', type:'pendientes'})"},{name:"Facturas emitidas",href:"listadoFacturas({clientID:'', type:'emitidas'})"},{name:"Facturas pagadas",href:"listadoFacturas({clientID:'', type:'pagadas'})"}],activeMenu:["listadoFacturas"]},{name:"Pedidos",href:"#",icon:"basket",subItems:[{name:"Pedidos presentados",href:"listadoPedidos({clientID:''})"},{name:"Pedidos aceptados",href:"listadoPedidosAceptados"},{name:"Hacer Pedido",href:"pedidoCrear"}],activeMenu:["listadoPedidos","pedidoCrear","listadoPedidosAceptados"]},{name:"Gastos",href:"#",icon:"credit-card",subItems:[{name:"Listado de Gastos",href:"listadoGastos"},{name:"Gastos Recurrentes",href:"listadoGastosRecurrentes"},{name:"Insertar Gastos",href:"insertarGastos"}],activeMenu:["listadoGastos","listadoGastosRecurrentes","insertarGastos"]},{name:"Productos",href:"#",icon:"archive",subItems:[{name:"Categorías",href:"familias"},{name:"Productos",href:"productosRootFamilias"},{name:"Crear Producto",href:"productosCrear"}],activeMenu:["familias","productosRootFamilias","productosCrear"]},{name:"Usuarios",href:"#",icon:"user",subItems:[{name:"Usuarios",href:"usuarios"},{name:"Crear usuario",href:"usuariosCrear"}],activeMenu:["usuarios","usuariosCrear"]},{name:"Configuración",icon:"cog",href:"configuracion",activeMenu:["configuracion"]},{name:"Ayuda",icon:"help",href:"ayuda",activeMenu:["ayuda"]}],e.showChilds=function(t){e.menu[t].active=!e.menu[t].active,e.collapseAnother(t)},e.collapseAnother=function(t){for(var r=0;r<e.menu.length;r++)r!=t&&(e.menu[r].active=!1)},e.collapseAll=function(t){for(var r=0;r<e.menu.length;r++)e.menu[r].active=!1},e.activeMenu=function(e){if("object"==typeof e){var r=!1;for(i=0;i<e.length;i++)t.includes(e[i])===!0&&(r=!0);return r}return t.includes(e)}}])}(),function(){var e=angular.module("homeController",["ui.bootstrap","ngMessages","graphicsService"]);e.controller("HomeController",["$scope","$rootScope","$state","GraphicsService","$q",function(e,t,r,n,o){function a(){var t,r=(new Date).getFullYear(),n=r-2015;for(i=0;i<=n;i++)t={value:r-i,name:r-i},e.projectYears.push(t)}sessionStorage.loginModal=!0,t.$watch("token",function(){t.currentUser&&t.token?e.showShortcuts=!0:r.go("login")}),e.projectYears=[{value:0,name:"Últimos 12 meses"}],a(),e.balance=function(e,t){var r=e.map(function(e,r){return parseFloat(e)-parseFloat(t[r])});return r},e.getProjectByYear=function(t){n.getProjectsByYear(t).then(function(t){e.labels=[],e.data=[];for(var r in t.data.data[0])e.labels.push(r),e.data.push(parseInt(t.data.data[0][r]));e.data=[e.data],e.series=["Nuevos proyectos","Proyectos finalizados"]})},e.updateProjectYear=function(){0===e.projectYear?e.getLastYearProjects():e.getProjectByYear(e.projectYear)},e.getLastYearProjects=function(){n.getLastYearProjects().then(function(t){e.labels=[],e.data=[],angular.forEach(t.data.data,function(t){e.labels.push(t.month),e.data.push(t.projects)}),e.data=[e.data],e.series=["Nuevos proyectos","Proyectos finalizados"]})},e.getLastYearProjects(),e.getAcceptedOrdersAmountByYear=function(t){var r=o.defer();return n.getAcceptedOrdersAmountByYear(t).then(function(t){for(var n in t.data.data[0])e.labelsInv.push(n),e.dataInv.push(parseInt(t.data.data[0][n]));e.dataInv=[e.dataInv],r.resolve(e.dataInv)}),r.promise},e.getPayedInvoicesAmountByYear=function(t){var r=o.defer(),a=[];return n.getPayedInvoicesAmountByYear(t).then(function(t){for(var n in t.data.data[0])a.push(parseInt(t.data.data[0][n]));e.dataInv.push(a),r.resolve(e.dataInv)}),r.promise},e.getExpensesByYear=function(t){var r=o.defer(),a=[];return n.getExpensesByYear(t).then(function(t){for(var n in t.data.data[0])a.push(parseInt(t.data.data[0][n]));e.dataInv.push(a),r.resolve(e.dataInv)}),r.promise},e.getInvoicesByYear=function(t){e.labelsInv=[],e.dataInv=[],e.getAcceptedOrdersAmountByYear(t).then(function(){o.all([e.getPayedInvoicesAmountByYear(t),e.getExpensesByYear(t)]).then(function(){var t=e.balance(e.dataInv[1],e.dataInv[2]);e.dataInv.push(t)})})},e.getLastYearAcceptedOrdersAmount=function(){var t=o.defer();return n.getLastYearAcceptedOrdersAmount().then(function(r){e.labelsInv=[],e.dataInv=[],angular.forEach(r.data.data,function(t){e.labelsInv.push(t.month),e.dataInv.push(t.total)}),e.dataInv=[e.dataInv],e.seriesInv=["Contratación","Ingresos","Gastos","Balance"],t.resolve(e.dataInv)}),t.promise},e.getLastYearPayedInvoicesAmount=function(){var t=o.defer(),r=[];return n.getLastYearPayedInvoicesAmount().then(function(n){angular.forEach(n.data.data,function(e){r.push(e.total)}),e.dataInv.push(r),t.resolve(e.dataInv)}),t.promise},e.getLastYearExpenses=function(){var t=o.defer(),r=[];return n.getLastYearExpenses().then(function(n){angular.forEach(n.data.data,function(e){r.push(e.total)}),e.dataInv.push(r),t.resolve(e.dataInv)}),t.promise},e.invoicesLastYearRender=function(){e.getLastYearAcceptedOrdersAmount().then(function(){o.all([e.getLastYearPayedInvoicesAmount(),e.getLastYearExpenses()]).then(function(){var t=e.balance(e.dataInv[1],e.dataInv[2]);e.dataInv.push(t)})})},e.updateInvoicesYear=function(){0===e.InvoicesYear?e.invoicesLastYearRender():e.getInvoicesByYear(e.InvoicesYear)},e.invoicesLastYearRender(),n.getSentInvoicesCount().then(function(t){e.invoicesCount=t.data.data[0].total}),n.getActiveProjectsCount().then(function(t){e.projectsCount=t.data.data[0].total}),n.getActiveTasksCount().then(function(t){e.tasksCount=t.data.data[0].total}),n.getSentOrdersCount().then(function(t){e.ordersCount=t.data.data[0].total}),n.getMonthInvoicesAmount().then(function(t){e.invoicesSum=t.data.data[0].total}),n.getMonthExpenses().then(function(t){e.expensesSum=t.data.data[0].total})}])}(),function(){var e=angular.module("clientsController",["clientsService","projectsService","ngMessages","ui.bootstrap"]);e.controller("ClientsController",["$scope","$modal","$timeout","ClientsService","config",function(e,t,r,n,o){e.maxPages=o.maxPages,e.itemsPerPage=o.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.getClients=function(){n.getClients(e.itemsPerPage,e.offset).then(function(t){e.clients=t.data.data,e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getClients(),e.deleteClient=function(o){e.clientID=o,e.modalInstance=t.open({templateUrl:"deleteClientModal.html",scope:e,controller:"ClientsController"}),e["delete"]=function(t){n.deleteClient(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Cliente eliminado correctamente."}],r(e.closeAlert,4e3),e.getClients()})}},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)},e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getClients()}}]),e.controller("DetailClientsController",["$rootScope","$scope","$stateParams","ClientsService","ProjectsService","$modal","$timeout","resolveClient","$state","$filter",function(e,t,r,n,o,a,s,i,c,l){var u=i.data;t.client=angular.copy(u),t.clientID=r.clientID,n.getClient(r.clientID).then(function(e){t.client=e.data}),n.getProvinces().then(function(e){t.provinces=e.data});var d=function(){c.go("clientes")};t.editClient=function(){n.editClient(t.client).then(function(e){1===e.data.status?(t.alerts=[{type:"success",msg:"Cliente editado correctamente."}],s(d,1e3)):t.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},t.originalEditForm=function(){return angular.equals(u,t.client)},t.closeAlert=function(e){t.alerts.splice(e,1)},t.deleteClient=function(){t.modalInstance=a.open({templateUrl:"deleteClientModal.html",scope:t,controller:"ClientsController"}),t["delete"]=function(){n.deleteClient(r.clientID).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Cliente eliminado correctamente."}],s(t.closeAlert,4e3),c.go("clientes")})}},t.predicate="end_date",t.getProjects=function(){o.getActiveProjects(t.clientID,t.itemsPerPage,t.offset).then(function(e){t.projects=e.data.data})},t.getProjects(),t.hourWarning=function(e){return e.hours_total>e.hours_budget?"label-danger":e.hours_total<e.hours_budget&&e.hours_total-e.hours_total/10<=e.hours_budget&&e.hours_total>e.hours_budget-e.hours_budget/10?"label-warning":"label-standart"},t.today=new Date,t.dateWarning=function(e){if(1===e.status){var r=new Date(e.end_date);return r.getTime()<=t.today.getTime()?"label-danger":r.getTime()>t.today.getTime()&&r.getTime()-1296e6<=t.today.getTime()?"label-warning":"label-standart"}return"label-standart"},t.selectable=function(){t.selectDisable=!t.selectDisable},t.getComments=function(){n.getComments(t.clientID).then(function(e){t.comments=e.data.data,t.commentsSearch=t.comments})},t.getComments(),t.addComment=function(){t.modalInstance=a.open({templateUrl:"addCommentModal.html",scope:t,controller:"ClientsController"}),t.comment={client_id:t.clientID,user_id:e.currentUserID},t.alerts=[],t.add=function(){n.addComment(t.comment).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Comentario añadido correctamente."}],s(t.closeAlert,1e3),t.getComments()})},t.cancel=function(){t.modalInstance.close()}},t.$watch("search",function(e){t.comments=l("filter")(t.commentsSearch,e)}),t.getTasks=function(){n.getClientTasks(t.clientID).then(function(e){t.tasks=e.data.data})},t.getTasks(),t.changeStatus=function(e,t,r){var n={};n.id=t,n.status=0===r?1:0,"project"==e?o.setProjectStatus(n).then(function(e){}):o.setTaskStatus(n).then(function(e){})},t.cancel=function(){t.modalInstance.close()}}]),e.controller("DetailClientsMenuController",["$scope","$stateParams",function(e,t){e.clientID=t.clientID}]),e.controller("AddClientsController",["$scope","ClientsService","$timeout","$state",function(e,t,r,n){t.getProvinces().then(function(t){e.provinces=t.data}),e.addClient=function(){var o=function(){n.go("clientes")};t.addClient(e.client).then(function(t){1===t.data.status?(e.alerts=[{type:"success",msg:"Cliente creado correctamente."}],r(o,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},e.closeAlert=function(t){e.alerts.splice(t,1)}}])}(),function(){var e=angular.module("productsController",["productsService","ngMessages","ui.bootstrap","ui.router.compat"]);e.controller("ProductsRootFamiliesController",["$scope","$state","ProductsService","$stateParams","config",function(e,t,r,n,o){e.maxPages=o.maxPages,e.itemsPerPage=o.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.familyID=n.familyID,e.getProducts=function(){e.familyID?r.getFamilies(e.familyID,e.itemsPerPage,e.offset).then(function(t){e.families=t.data.data,angular.forEach(e.families,function(t){r.getFinalFamilies(t.id,e.itemsPerPage,e.offset).then(function(e){t.row=e.data.rows,t.href=0===e.data.rows?"producto/"+t.name+"/"+t.id:"productos/"+t.id})}),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)}):r.getRootFamilies(e.itemsPerPage,e.offset).then(function(t){e.families=t.data.data,angular.forEach(e.families,function(e){r.getFinalFamilies(e.id).then(function(t){e.href=0===t.data.rows?"producto/"+e.name+"/"+e.id:"productos/"+e.id})}),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getProducts(),e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getProducts()},e.state=t.current.name}]),e.controller("ProductsListController",["$scope","$stateParams","$filter","$state","ProductsService","config",function(e,t,r,n,o,a){e.maxPages=a.maxPages,e.itemsPerPage=a.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.familyID=t.familyID,isFinite(String(e.familyID))||(e.familyID=""),e.getProducts=function(){o.getProducts(e.familyID,e.itemsPerPage,e.offset).then(function(t){e.products=t.data.data,e.productsSearch=e.products,e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getProducts(),e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getProducts()},e.$watch("search",function(t){e.products=r("filter")(e.productsSearch,t)}),e.state=n.current.name}]),e.controller("AddProductsController",["$scope","ProductsService","$location","$q","$upload","$state","$timeout","config",function(e,t,r,n,o,a,s,i){t.getVAT().then(function(t){e.vat=t.data}),t.getFamilies(null).then(function(r){e.selectFamilies=[],angular.forEach(r.data.data,function(r,n){t.getFinalFamilies(r.id).then(function(t){0===t.data.rows&&e.selectFamilies.push(r)})})}),e.product={},e.product.active=1,e.closeAlert=function(t){e.alerts.splice(t,1)},e.url=i.domain+i.imagePath,e.price=[{name:"",units:"",price:"",product_id:""}],e.removePrice=function(t){e.price.splice(t,1)},e.addPrice=function(){e.price.push({price:""})},e.onFileSelect=function(r){e.tempFile=[];var n=r[0];return e.tempFile.name="",n.type.indexOf("image")==-1?(e.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",e.files=!1,!1):n.size>10485760?(e.error="El tamaño máximo permitido son 10MB",e.files=!1,!1):void t.uploadProductImage(n).progress(function(t){e.loading=parseInt(100*t.loaded/t.total)}).success(function(t,r,o,a){e.tempFile.name=n.name,e.tempFile.id=t.data,e.tempFile.src=t.src,e.files=!0,e.error=!1}).error(function(t){e.message=t})},e.deleteProductImage=function(r){t.deleteProductImage(r).then(function(t){e.tempFile.name=null,e.tempFile.id=null,e.tempFile.src=null,e.files=!1})},e.addProduct=function(){function r(r){return n(function(n,o){t.addProduct(r).then(function(t){productID=t.data.data,angular.forEach(e.price,function(e,t){e.product_id=productID}),n(productID)})})}function o(e,r){t.saveProductImage(e,r)}function i(e){t.addFormat(e)}var c=function(){a.go(a.$current,null,{reload:!0})},l=r(e.product);l.then(function(t){e.files===!0?n.all([o(e.tempFile.id,productID),i(e.price)]).then(function(){t?(e.alerts=[{type:"success",msg:"Producto creado correctamente."}],s(c,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]}):n.all([i(e.price)]).then(function(){t?(e.alerts=[{type:"success",msg:"Producto creado correctamente."}],s(c,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo"}]})})}}]),e.controller("ProductsDetailController",["$scope","$stateParams","ProductsService","$location","$q","resolveProduct","resolvePrice","resolveProductImage","$window","$timeout","config","$modal","$state",function(e,t,r,n,o,a,s,i,c,l,u,d,g){var m=a.data;e.product=angular.copy(m);var p=s.data;e.price=angular.copy(p);var f=i.data;angular.forEach(f,function(t){e.image=t}),e.url=u.domain+u.imagePath,r.getProduct(t.productID).then(function(t){e.product=t.data}),r.getFamilies(null).then(function(t){e.selectFamilies=[],angular.forEach(t.data.data,function(t,n){r.getFinalFamilies(t.id).then(function(r){0===r.data.rows&&e.selectFamilies.push(t);
})})}),e.closeAlert=function(t){e.alerts.splice(t,1)},r.getProductPrice(t.productID).then(function(t){e.price=t.data,e.price&&(e.clearPrice=[])}),e.removePrice=function(t,r){e.price.splice(t,1),e.clearPrice.push(r)},e.addPrice=function(){e.price.push({id:"",name:"",units:"",price:"",product_id:t.productID})},r.getVAT().then(function(t){e.vat=t.data}),r.getProductImage(t.productID).then(function(t){e.tempFile=[],angular.forEach(t.data,function(r){t.data.length>0?(e.files=r,e.tempFile.name=r.url,e.tempFile.id=r.id,e.tempFile.src=r.url):(e.files=!1,e.image=!1)})}),e.deleteProductImage=function(t){e.imageID=t,e.modalInstance=d.open({templateUrl:"deleteImageModal.html",scope:e}),e.deleteImage=function(t){r.deleteProductImage(t).then(function(t){e.modalInstance.dismiss(),e.tempFile.name=null,e.tempFile.id=null,e.tempFile.src=null,e.files=!1,e.alerts=[{type:"success",msg:"Imagen eliminada correctamente."}],l(e.closeAlert,2e3)})}},e.onFileSelect=function(t){e.tempFile=[];var n=t[0];return e.tempFile.name="",n.type.indexOf("image")==-1?(e.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",e.files=!1,!1):n.size>10485760?(e.error="El tamaño máximo permitido son 10MB",e.files=!1,!1):void r.uploadProductImage(n).progress(function(t){e.loading=parseInt(100*t.loaded/t.total)}).success(function(t,r,o,a){e.tempFile.name=n.name,e.tempFile.id=t.data,e.tempFile.src=t.src,e.files=!0,e.error=!1}).error(function(t,r){e.message=t})},e.deleteProduct=function(){e.modalInstance=d.open({templateUrl:"deleteProductModal.html",scope:e}),e["delete"]=function(){r.deleteProduct(t.productID).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Producto eliminado correctamente."}],l(e.closeAlert,4e3),g.go("productosRootFamilias")})}},e.cancel=function(){e.modalInstance.close()},e.erasePrice=function(){e.clearPrice.length>0&&r.deleteFormat(e.clearPrice)},e.editProduct=function(){var n=function(){c.history.back()};e.files?o.all([r.editProduct(e.product),e.erasePrice(),r.editFormat(e.price),r.saveProductImage(e.tempFile.id,t.productID)]).then(function(t){t?(e.alerts=[{type:"success",msg:"Producto editado correctamente."}],l(n,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]}):o.all([r.editProduct(e.product),e.erasePrice(),r.editFormat(e.price)]).then(function(t){t?(e.alerts=[{type:"success",msg:"Producto editado correctamente."}],l(n,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},e.originalEditForm=function(){return angular.equals(m,e.product)&&angular.equals(p,e.price)&&angular.equals(e.image,e.files)},e.originalImage=function(){return angular.equals(e.image,e.files)}}])}(),function(){var e=angular.module("ordersController",["clientsService","ordersService","configService","ngMessages","ui.bootstrap"]);e.controller("MakeOrderController",["$scope","ClientsService","$modal","$state",function(e,t,r,n){t.getClients().then(function(t){e.clients=t.data.data,e.selected={}}),e.startOrder=function(){e.order.client=e.selected.value.id,localStorage.setObject("order",e.order),"byProduct"==localStorage.appProductMode?n.go("addProductosPedido"):n.go("categoriasPedido")},localStorage.order?(e.order=localStorage.getObject("order"),e.order.id?(localStorage.removeItem("order"),e.order={}):e.modalInstance=r.open({templateUrl:"myModalContent.html",scope:e})):e.order={},e.ok=function(){e.modalInstance.close(),"byProduct"==localStorage.appProductMode?n.go("addProductosPedido"):n.go("categoriasPedido")},e.cancel=function(){e.modalInstance.dismiss(),localStorage.removeItem("order"),e.order={}}}]),e.controller("OrderAddProductController",["$scope","ProductsService","OrdersService","$state","$stateParams","$filter","config",function(e,t,r,n,o,a,s){localStorage.order?e.order=localStorage.getObject("order"):n.go("pedidoCrear"),e.maxPages=s.maxPages,e.itemsPerPage=s.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.familyID=o.familyID,e.order.products?r.getProducts(e.familyID,e.itemsPerPage,e.offset).then(function(t){e.products=e.mergeProducts(t.data.data,e.order.products),e.products.price="",e.getFormat(),e.getVatVal(),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)}):(r.getProducts(e.familyID,e.itemsPerPage,e.offset).then(function(t){e.products=t.data.data,e.getFormat(),e.getVatVal(),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)}),e.order.products=[]),e.getProducts=function(){r.getProducts(e.familyID,e.itemsPerPage,e.offset).then(function(t){e.products=t.data.data,e.getFormat(),e.getVatVal(),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getProducts(),e.updateOrder=function(t){e.tempProducts=a("filter")(e.products,{isAdd:!0},!0),e.order.products=e.order.products.concat(e.tempProducts),e.getProducts()},e.$watch("order.products",function(){localStorage.setObject("order",e.order),e.order.products&&e.order.products.length>0?e.productUnits=localStorage.getObject("order").products.length:e.productUnits=-1,e.$watch("productUnits",function(e){e&&r.setProductUnits(e)})}),e.getFormat=function(){angular.forEach(e.products,function(e){e.units||(e.units=1),t.getProductPrice(e.id).then(function(t){t.data.length&&(e.format=t.data,1===t.data.length&&angular.forEach(t.data,function(t){e.price=t.id}))})})},e.getVatVal=function(){angular.forEach(e.products,function(e){r.getVATPercent(e.vat).then(function(t){e.vatPercent=t.data.vat})})},e.mergeProducts=function(e,t){for(var r=angular.copy(e),n=0;n<r.length;n++)for(var o=r[n],a=0;a<t.length;a++){var s=t[a];if(s.id===o.id)for(var i in s)o[i]=s[i]}return r},e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getProducts()},e.view=localStorage.appDefaultView,e.$watch(function(){return r.getView()},function(t){t&&(e.view=t)})}]),e.controller("OrderCategoryController",["$scope","ProductsService","OrdersService","$stateParams","config",function(e,t,r,n,o){e.maxPages=o.maxPages,e.itemsPerPage=o.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.familyID=n.familyID,e.getProducts=function(){e.familyID?t.getFamilies(e.familyID,e.itemsPerPage,e.offset).then(function(r){e.families=r.data.data,angular.forEach(e.families,function(r){t.getFinalFamilies(r.id,e.itemsPerPage,e.offset).then(function(e){r.row=e.data.rows,r.href=0===e.data.rows?"crear-pedido/producto/"+r.name+"/"+r.id:"crear-pedido/productos/"+r.id})}),e.results=r.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)}):t.getRootFamilies(e.itemsPerPage,e.offset).then(function(r){e.families=r.data.data,angular.forEach(e.families,function(e){t.getFinalFamilies(e.id).then(function(t){e.row=t.data.rows,e.href=0===t.data.rows?"crear-pedido/producto/"+e.name+"/"+e.id:"crear-pedido/productos/"+e.id})}),e.results=r.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getProducts(),e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getProducts()},e.view=localStorage.appDefaultView,e.$watch(function(){return r.getView()},function(t){t&&(e.view=t)})}]),e.controller("OrderAddProductMenuController",["$scope","OrdersService","$state","config",function(e,t,r,n){e.endOrder=function(){e.order=localStorage.getObject("order"),e.order.products&&e.order.products.length>0?(e.error=!1,angular.forEach(e.order.products,function(t){t.format.length>1&&!t.price&&(e.alerts=[{type:"danger",msg:"Selecciona el formato de los productos seleccionados para continuar."}],e.closeAlert=function(t){e.alerts.splice(t,1)},e.error=!0)}),e.error===!1&&r.go("resumenPedido")):(e.alerts=[{type:"danger",msg:"No has seleccionado ningún producto"}],e.closeAlert=function(t){e.alerts.splice(t,1)})},e.$watch(function(){return t.getProductUnits()},function(t){t&&(e.productUnits=t)}),e.view=localStorage.appDefaultView,e.changeView=function(r){t.setView(r),e.view=r}}]),e.controller("OrderResumeController",["$rootScope","$scope","OrdersService","ProductsService","$state","$filter","config",function(e,t,r,n,o,a,s){localStorage.order?(t.order=localStorage.getObject("order"),t.order.id?e.title="Detalle de pedido":t.order.price={}):o.go("pedidoCrear"),1===t.order.accepted?t.editable=!1:t.editable=!0,t.products=t.order.products,t.updateOrder=function(){t.order.products=a("filter")(t.products,{isSelected:!0},!0)},t.applyDiscount=function(e,t){if(!e)return t;var r=e.toString().slice(-1);return"%"==r?parseFloat(e)<100?t*(100-parseFloat(e))/100:t:e<t?t-e:e>=t||0===e?t:void 0},t.price=function(){var e=0,n=0;angular.forEach(t.order.products,function(o){r.getPrice(o.price).then(function(r){t.order.price.discount="";var a=t.applyDiscount(o.discount,r.data.price*o.units);e=parseFloat(e+a);var s=a*(o.vatPercent/100);n+=parseFloat(s.toFixed(2)),t.totalPrice=e,t.totalVat=n,t.totalPriceVat=parseFloat(t.totalPrice+t.totalVat),t.order.price.price=parseFloat(t.totalPrice).toFixed(2),t.order.price.vat=parseFloat(t.totalVat).toFixed(2),t.order.price.total=parseFloat(t.totalPriceVat.toFixed(2)),angular.forEach(o.format,function(e){e.id==o.price&&(o.formatName=e.name)}),o.discount||(o.discount=0),o.unitPrice=r.data.price,o.priceVal=parseFloat(a),o.vatVal=parseFloat(a*(o.vatPercent/100)),localStorage.setObject("order",t.order)})})},t.setPrice=function(){t.vat?t.price():r.getVAT().then(function(e){t.vat=e.data,t.price()})},t.$watch("order.products",function(){localStorage.setObject("order",t.order),t.setPrice()}),t.actions={},t.view=localStorage.appDefaultView,t.$watch(function(){return r.getView()},function(e){e&&(t.view=e)})}]),e.controller("OrderDetailController",["$scope","$stateParams","OrdersService",function(e,t,r){r.getOrderLines(t.orderID).then(function(t){e.products=t.data}),r.getOrder(t.orderID).then(function(t){e.order=t.data,e.total=e.order.price+e.order.vat})}]),e.controller("OrderResumeMenuController",["$scope","OrdersService","ClientsService","$state","$modal","$q","$timeout",function(e,t,r,n,o,a,s){function i(e){return a(function(r,n){t.addOrder(e).then(function(e){OrderID=e.data.data,r(OrderID)})})}function c(r,o){t.addOrderLines(r,o).then(function(){e.alerts=[{type:"success",msg:"El pedido ha sido creado correctamente."}];var t=function(){localStorage.removeItem("order"),n.go("listadoPedidos")};s(t,4e3),e.closeAlert=function(r){e.alerts.splice(r,1),t()}})}function l(e){t.editOrder(e).then(function(e){})}function u(e,r){t.editOrderLines(e,r).then(function(e){})}e.order=localStorage.getObject("order"),1===e.order.accepted?e.editable=!1:e.editable=!0,r.getClient(e.order.client).then(function(t){e.clientName=t.data.name}),e.confirmOrder=function(){if(e.order=localStorage.getObject("order"),e.order.products.length>0)if(e.orderData={price:e.order.price.price,vat:e.order.price.vat,discount:e.order.price.discount,client_id:e.order.client,client_name:e.clientName,total:e.order.price.total},e.order.id)e.orderData.id=e.order.id,a.all([l(e.orderData),u(e.order.products,e.order.id)]).then(function(){e.alerts=[{type:"success",msg:"El pedido ha sido modificado correctamente."}];var t=function(){localStorage.removeItem("order"),n.go("listadoPedidos")};s(t,4e3),e.closeAlert=function(r){e.alerts.splice(r,1),t()}});else{var t=i(e.orderData);t.then(function(t){c(e.order.products,OrderID)})}else e.alerts=[{type:"danger",msg:"No has añadido ningún producto"}],e.closeAlert=function(t){e.alerts.splice(t,1)}},e.cancelOrder=function(){e.order.id?templateModel="OrderEditModelContent.html":templateModel="OrderCreateModelContent.html",e.modalInstance=o.open({templateUrl:templateModel,scope:e}),e.ok=function(){e.modalInstance.dismiss()},e.cancel=function(){e.modalInstance.close(),localStorage.removeItem("order"),e.goBack()}},e.addMoreProducts=function(){"byProduct"==localStorage.appProductMode?n.go("addProductosPedido"):n.go("categoriasPedido")}}]),e.controller("OrderListController",["$rootScope","$scope","$modal","$timeout","$state","OrdersService","$q","$stateParams","ProductsService","config",function(e,t,r,n,o,a,s,i,c,l){function u(e){return s(function(r,n){localStorage.removeItem("order"),a.getOrder(e).then(function(n){t.order.client=n.data.client_id,t.order.accepted=n.data.accepted,t.order.price={},t.order.id=e,t.order.price.discount=n.data.discount,r(e)})})}function d(e){return s(function(r,n){a.getOrderLines(e).then(function(e){productID=e.data.id,t.order.products=e.data,angular.forEach(t.order.products,function(e){delete e.vat,delete e.order_id,e.units=parseInt(e.units),0!==e.discount&&(e.showDiscount=!0),m(e,"id","idLine"),m(e,"product_id","id"),m(e,"product_name","name"),m(e,"vat_id","vat"),m(e,"format_id","price"),m(e,"unit_price","unitPrice"),m(e,"vat_percent","vatPercent"),e.isSelected=!0}),r(t.order.products)})})}function g(e){var r=[];angular.forEach(e,function(e){r.push(c.getProductPrice(e.id).then(function(t){e.format=t.data}))}),s.all(r).then(function(){localStorage.setObject("order",t.order),o.go("resumenPedido")})}function m(e,t,r){return!!e.hasOwnProperty(t)&&(e[r]=e[t],delete e[t],!0)}t.maxPages=l.maxPages,t.itemsPerPage=l.itemsPerPage,i.clientID&&(e.title="Pedidos"),"listadoPedidosAceptados"==o.current.name?t.accepted=1:t.accepted=0,t.currentPage=1,t.offset=t.itemsPerPage*(t.currentPage-1),t.paginator=!0,t.pageChanged=function(){t.offset=t.itemsPerPage*(t.currentPage-1),t.getOrders()},i.clientID?t.clientID=i.clientID:t.clientID=null,t.getOrders=function(){a.getOrders(t.clientID,t.itemsPerPage,t.offset,t.accepted).then(function(e){e.data.data.length<1&&(t.noResults=!0),angular.forEach(e.data.data,function(e){e.id=parseInt(e.id),e.price=parseFloat(e.price),t.clientName=e.client_name}),t.orders=e.data.data,t.predicate="-id",t.results=e.data.length,t.results<=t.itemsPerPage&&(t.paginator=!1)})},t.getOrders(),t.deleteOrder=function(e){t.orderID=e,t.modalInstance=r.open({templateUrl:"deleteOrderModal.html",scope:t,controller:"OrderListController"}),t["delete"]=function(e){a.deleteOrder(e).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Pedido eliminado correctamente."}],n(t.closeAlert,4e3),t.getOrders()})}},a.getPaymentMethods().then(function(e){t.PaymentMethods=e.data}),a.getInstallments().then(function(e){t.installments=e.data});var p=new Date;t.timezoneOffset=p.getTimezoneOffset()/60,t.acceptOrder=function(e,o,s){t.modalInstance=r.open({templateUrl:"acceptOrderModal.html",scope:t,controller:"OrderListController"}),t.alerts=[],t.accept=function(r,c){r.id=e,r.total=s,c.order_id=e,i.clientID?c.client_id=parseInt(i.clientID):c.client_id=o,a.acceptOrder(r,c).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Pedido aceptado"}],n(t.redirect,1e3)})}},t.order={},t.orderDetail=function(e){var t=u(e);t.then(function(e){d(e).then(function(e){g(e)})})},t.projectDetail=function(e){o.go("proyectosDetalle",{projectID:e})},t.cancel=function(){t.modalInstance.close()},t.closeAlert=function(e){t.alerts.splice(e,1)},t.redirect=function(){i.clientID?o.go("listadoPedidosAceptados",{clientID:i.clientID}):o.go("listadoPedidosAceptados")}}]),e.controller("InvoiceListController",["$scope","$modal","$timeout","$stateParams","OrdersService","config",function(e,t,r,n,o,a){switch(e.maxPages=a.maxPages,e.itemsPerPage=a.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getInvoices()},e.clientID=n.clientID,e.orderID=n.orderID,n.type){case"pendientes":e.type=0;break;case"emitidas":e.type=1;break;case"pagadas":e.type=2;break;default:e.type=null}e.getInvoices=function(){o.getInvoices(e.clientID,e.orderID,e.itemsPerPage,e.offset,e.type).then(function(t){t.data.length<1&&(e.noResults=!0),angular.forEach(t.data.data,function(e){switch(e.id=parseInt(e.id),e.status){case"0":e.status_name="pendiente";break;case"1":e.status_name="emitida";break;case"2":e.status_name="pagada"}}),e.invoices=t.data.data,e.predicate="-date",e.results=t.data.length,e.clientName=t.data.data[0].client_name,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getInvoices(),e.deleteInvoice=function(n){e.invoiceID=n,e.modalInstance=t.open({templateUrl:"deleteInvoiceModal.html",scope:e,controller:"InvoiceListController"}),e["delete"]=function(t){o.deleteInvoice(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Factura eliminada correctamente."}],r(e.closeAlert,4e3),e.getInvoices()})}},e.changeStatus=function(n,a){e.invoiceID=n,e.status=a,e.modalInstance=t.open({templateUrl:"invoiceChangeStatusModal.html",scope:e,controller:"InvoiceListController"}),e.change=function(){o.invoiceChangeStatus(e.invoiceID,e.status).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Estado actualizado."}],r(e.closeAlert,1e3),e.getInvoices()})}},e.switchClass=function(e){switch(e){case"pendiente":return"label-danger";case"emitida":return"label-warning";case"pagada":return"label-success"}},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)}}]),e.controller("DetailInvoiceController",["$scope","$stateParams","OrdersService","ConfigService",function(e,t,r,n){e.invoiceID=t.invoiceID,e.discount=!1,r.getInvoice(e.invoiceID).then(function(t){e.invoice=t.data,"Thu Jan 01 1970 01:00:00 GMT+0100 (Hora estándar romance)"==e.invoice.date&&(e.invoice.date=null),null!==e.invoice.date&&(e.year=e.invoice.date.getFullYear().toString().substring(2,4)),e.percentage=e.invoice.percentage,e.invoiceInstallment=e.invoice.subTotal,e.orderID=t.data.order_id,e.invoice.installmentBase=(Math.round((e.invoice.total-e.invoice.vat)*e.percentage*100)/100).toFixed(2),e.invoice.installmentVat=(Math.round(e.invoice.vat*e.percentage*100)/100).toFixed(2);var o=Number(e.invoiceInstallment)-(Number(e.invoice.installmentBase)+Number(e.invoice.installmentVat));o>0?e.invoice.installmentBase=(Math.ceil((e.invoice.total-e.invoice.vat)*e.percentage*100)/100).toFixed(2):o<0&&(e.invoice.installmentBase=(Math.floor((e.invoice.total-e.invoice.vat)*e.percentage*100)/100).toFixed(2)),r.getOrderLines(e.invoice.order_id).then(function(t){e.products=t.data,e.vats={},e.iva=[],e.base={},e.bases=[],angular.forEach(e.products,function(t,r){t.discount>0&&(e.discount=!0),t.discount=e.discountSimbol(t.discount),t.vat=t.vat*e.percentage,t.price=t.price*e.percentage,o>0?(t.price=Math.ceil(100*t.price)/100,0===r?t.vat=Math.floor(100*t.vat)/100:t.vat=Math.round(100*t.vat)/100):o<0?(t.price=Math.floor(100*t.price)/100,0===r?t.vat=Math.ceil(100*t.vat)/100:t.vat=Math.round(100*t.vat)/100):(0===r?t.vat=Math.floor(100*t.vat)/100:t.vat=Math.round(100*t.vat)/100,t.price=Math.round(100*t.price)/100),e.vats[t.vat_percent]?(e.vats[t.vat_percent]=parseFloat(e.vats[t.vat_percent])+parseFloat(t.vat),e.base[t.vat_percent]=parseFloat(e.base[t.vat_percent])+parseFloat(t.price)):(e.vats[t.vat_percent]=parseFloat(t.vat),e.base[t.vat_percent]=parseFloat(t.price))}),angular.forEach(e.vats,function(t,r){angular.forEach(e.base,function(n,o){r==o&&e.iva.push({id:r,value:t,base:n})})}),e.productsCopy=angular.copy(e.products)}),e.discountSimbol=function(e){return isNaN(e)||e.indexOf("€")!==-1?e:e+"€"},n.getUserData().then(function(t){e.userData=t.data})})}]),e.controller("DetailInvoiceMenuController",["$scope",function(e){e.print=function(){window.print()}}])}(),function(){var e=angular.module("familiesController",["familiesService"]);e.controller("FamiliesController",["$scope","$modal","$timeout","FamiliesService",function(e,t,r,n){n.getFamilies(null).then(function(t){e.familias=t.data.data}),e.getFamilyTree=function(){n.getRootFamilies().then(function(t){e.rootFamilies=t.data.data,e.recursive=function(t){t&&angular.forEach(t,function(t){n.getFamilies(t.id).then(function(r){t.child=r.data.data,e.recursive(t.child)})})},e.recursive(e.rootFamilies)})},e.getFamilyTree(),e.editFamily=function(o){n.getFamily(o).then(function(t){e.familia=t.data}),e.modalInstance=t.open({templateUrl:"editFamilyModal.html",scope:e,controller:"FamiliesController"}),e.alerts=[],e.edit=function(t){n.editFamily(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Familia editada correctamente."}],e.getFamilyTree(),r(e.closeAlert,4e3)})}},e.deleteFamily=function(o){e.familyID=o,e.modalInstance=t.open({templateUrl:"deleteFamilyModal.html",scope:e,controller:"FamiliesController"}),e.alerts=[],e["delete"]=function(t){n.deleteFamily(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Familia eliminada correctamente."}],e.getFamilyTree(),r(e.closeAlert,4e3)})}},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)}}]),e.controller("FamiliesMenuController",["$scope","$modal","$state","$timeout","FamiliesService",function(e,t,r,n,o){o.getFamilies(null).then(function(t){e.familias=t.data.data}),e.addFamilia=function(){e.modalInstance=t.open({templateUrl:"myModalContent.html",scope:e,controller:"FamiliesController"}),e.newFamily={},e.alerts=[],e.add=function(){o.addFamily(e.newFamily).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Familia creada correctamente."}],n(e.closeAlert,4e3)})},e.cancel=function(){e.modalInstance.close()}},e.closeAlert=function(t){e.alerts.splice(t,1),r.go(r.current,{},{reload:!0})}}])}(),function(){var e=angular.module("loginController",["loginService","ngMessages","ui.bootstrap","ui.router.compat"]);e.controller("LoginController",["$rootScope","$scope","LoginService","$modalInstance",function(e,t,r,n){t.cancel=function(){n.dismiss(),sessionStorage.removeItem("loginModal"),delete e.currentUser,delete e.currentUserImg,delete e.token,delete e.userRol,delete e.currentuserID,$state.go("login")},t.submit=function(){r.login(t.login.username,t.login.password).then(function(e){n.close(e),sessionStorage.removeItem("loginModal")})}}]),e.controller("LoginFormController",["$scope","$rootScope","$window","$state","$timeout","LoginService",function(e,t,r,n,o,a){sessionStorage.loginModal=!0,t.$watch("token",function(){t.currentUser&&t.token?e.showShortcuts=!0:e.showShortcuts=!1}),e.login=[],e.submit=function(){a.login(e.login.username,e.login.password).then(function(r){t.currentUser=sessionStorage.user=r.data.username,t.currentUserImg=sessionStorage.userImg=r.data.url,t.currentUserID=sessionStorage.userID=r.data.id,t.token=sessionStorage.token=r.token,t.userRol=sessionStorage.userRol=r.data.userRol,e.showShortcuts=!0,sessionStorage.loginModal=!0,n.go("index")})},e.closeAlert=function(e){delete t.alerts}}])}(),function(){var e=angular.module("configController",["productsService","clientsService","configService","ngMessages","ui.bootstrap"]);e.controller("ConfigController",["$scope","$modal","$timeout","ProductsService","ConfigService","ClientsService","config",function(e,t,r,n,o,a,s){a.getProvinces().then(function(t){e.provinces=t.data}),e.userData=function(){o.getUserData().then(function(t){e.user=t.data})},e.userData(),e.restoreUserData=function(){e.userData()},e.editUserData=function(){e.alerts=[],o.editUserData(e.user).then(function(t){e.alerts=[{type:"success",msg:"Datos actualizados correctamente."}],r(e.closeAlert,4e3),e.userData()})},e.getVat=function(){n.getVAT().then(function(t){e.vats=t.data})},e.getVat(),e.deleteVat=function(n){e.vatID=n,e.modalInstance=t.open({templateUrl:"deleteVatModal.html",scope:e,controller:"ConfigController"}),e["delete"]=function(t){o.deleteVat(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"IVA eliminado correctamente."}],r(e.closeAlert,4e3),e.getVat()})}},e.addVat=function(){e.modalInstance=t.open({templateUrl:"addVatModal.html",scope:e,controller:"ConfigController"}),e.alerts=[],e.add=function(t){o.addVat(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"IVA añadido correctamente."}],r(e.closeAlert,4e3),e.getVat()})}},e.defaultView=sessionStorage.appDefaultView,e.productMode=localStorage.appProductMode,e.changeDefaultView=function(){e.alerts=[],localStorage.appDefaultView=e.defaultView,e.alerts=[{type:"success",msg:"Vista cambiada correctamente."}],r(e.closeAlert,2e3)},e.changeProductMode=function(){e.alerts=[],localStorage.appProductMode=e.productMode,e.alerts=[{type:"success",msg:"Modo cambiado correctamente."}],r(e.closeAlert,2e3)},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)},e.url=s.domain+s.imagePath,o.getInvoiceImage().then(function(t){e.tempFile=[],t.data.image?(e.files=!0,e.tempFile.name=t.data.image,e.tempFile.src=t.data.image):(e.files=!1,e.image=!1)}),e.deleteInvoiceImage=function(){e.modalInstance=t.open({templateUrl:"deleteImageModal.html",scope:e}),e.deleteImage=function(){o.deleteInvoiceImage().then(function(t){e.modalInstance.dismiss(),e.tempFile.name=null,e.tempFile.id=null,e.tempFile.src=null,e.files=!1,e.alerts=[{type:"success",msg:"Imagen eliminada correctamente."}],r(e.closeAlert,2e3)})}},e.onFileSelect=function(t){e.tempFile=[];var r=t[0];return e.tempFile.name="",r.type.indexOf("image")==-1?(e.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",e.files=!1,!1):r.size>10485760?(e.error="El tamaño máximo permitido son 10MB",e.files=!1,!1):void o.uploadInvoiceImage(r).progress(function(t){e.loading=parseInt(100*t.loaded/t.total)}).success(function(t,n,o,a){e.tempFile.name=r.name,e.tempFile.id=t.data,e.tempFile.src=t.src,e.files=!0,e.error=!1}).error(function(t,r){e.message=t})}}])}(),function(){var e=angular.module("usersController",["usersService","ngMessages","ui.bootstrap"]);e.controller("UsersController",["$scope","$modal","$timeout","UsersService","config",function(e,t,r,n,o){e.maxPages=o.maxPages,e.itemsPerPage=o.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.getUsers=function(){n.getUsers(e.itemsPerPage,e.offset).then(function(t){e.users=t.data.data,angular.forEach(e.users,function(e){n.getRol(e.userRol).then(function(t){e.rol=t.data.userRol})}),e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getUsers(),e.deleteUser=function(o){e.userID=o,e.modalInstance=t.open({templateUrl:"deleteUserModal.html",scope:e,controller:"UsersController"}),e["delete"]=function(t){n.deleteUser(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Usuario eliminado correctamente."}],r(e.closeAlert,4e3),e.getUsers()})}},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)},e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getUsers()}}]),e.controller("DetailUsersController",["$scope","$stateParams","UsersService","$location","$modal","$timeout","resolveUser","$state","config","$q",function(e,t,r,n,o,a,s,i,c,l){var u=s.data;delete u.password,u.newPassword="",e.user=angular.copy(u),e.userID=t.userID,r.getRoles().then(function(t){e.roles=t.data}),e.getUser=function(){r.getUser(e.userID).then(function(t){e.user=t.data,e.user.rol="",e.user.newPassword="",r.getRol(e.user.userRol).then(function(t){e.user.rol=t.data.userRol,u.rol=t.data.userRol,delete e.user.password})})},e.getUser();var d=function(){i.go("usuarios")};e.editUser=function(){""!==e.user.newPassword&&e.user.newPassword!==!1&&(e.user.password=e.user.newPassword),l.all([r.editUser(e.user),r.saveUserImage(e.tempFile.id,e.userID)]).then(function(t){t?(e.alerts=[{type:"success",msg:"Usuario editado correctamente."}],a(d,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},e.originalEditForm=function(){return angular.equals(u,e.user)},e.closeAlert=function(t){e.alerts.splice(t,1)},e.deleteUser=function(){e.modalInstance=o.open({templateUrl:"deleteUserModal.html",scope:e,controller:"UsersController"}),e["delete"]=function(){r.deleteUser(t.userID).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Usuario eliminado correctamente."}],a(e.closeAlert,4e3),i.go("usuarios")})}},e.cancel=function(){e.modalInstance.close()},e.url=c.domain+c.imagePath,r.getUserImage(e.userID).then(function(t){e.tempFile=[],angular.forEach(t.data,function(r){t.data.length>0?(e.files=r,e.tempFile.name=r.url,e.tempFile.id=r.id,e.tempFile.src=r.url):(e.files=!1,e.image=!1)})}),e.deleteUserImage=function(t){e.imageID=t,e.modalInstance=o.open({templateUrl:"deleteImageModal.html",scope:e}),e.deleteImage=function(t){r.deleteUserImage(t).then(function(t){e.modalInstance.dismiss(),e.tempFile.name=null,e.tempFile.id=null,e.tempFile.src=null,e.files=!1,e.originalEditForm=function(){return angular.equals(u,e.user)},e.alerts=[{type:"success",msg:"Imagen eliminada correctamente."}],a(e.closeAlert,2e3)})}},e.onFileSelect=function(t){e.tempFile=[];var n=t[0];return e.tempFile.name="",n.type.indexOf("image")==-1?(e.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",e.files=!1,!1):n.size>10485760?(e.error="El tamaño máximo permitido son 10MB",e.files=!1,!1):void r.uploadUserImage(n).progress(function(t){e.loading=parseInt(100*t.loaded/t.total)}).success(function(t){e.tempFile.name=n.name,e.tempFile.id=t.data,e.tempFile.src=t.src,e.files=!0,e.error=!1,e.originalEditForm=!1}).error(function(t){e.message=t})}}]),e.controller("AddUsersController",["$scope","UsersService","$location","$q","$timeout","$state","$upload","config",function(e,t,r,n,o,a,s,i){t.getRoles().then(function(t){e.roles=t.data}),e.url=i.domain+i.imagePath,e.onFileSelect=function(r){e.tempFile=[];var n=r[0];return e.tempFile.name="",n.type.indexOf("image")==-1?(e.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",e.files=!1,!1):n.size>10485760?(e.error="El tamaño máximo permitido son 10MB",e.files=!1,!1):void t.uploadUserImage(n).progress(function(t){e.loading=parseInt(100*t.loaded/t.total)}).success(function(t){e.tempFile.name=n.name,e.tempFile.id=t.data,e.tempFile.src=t.src,e.files=!0,e.error=!1}).error(function(t){e.message=t})},e.deleteUserImage=function(r){t.deleteProductImage(r).then(function(t){e.tempFile.name=null,e.tempFile.id=null,e.tempFile.src=null,e.files=!1})},e.addUser=function(){function r(e){return n(function(r,n){t.addUser(e).then(function(e){userID=e.data.data,r(userID)})})}function s(e,r){t.saveUserImage(e,r)}var i=function(){a.go(a.$current,null,{reload:!0})},c=r(e.user);c.then(function(t){e.files===!0&&s(e.tempFile.id,userID),t?(e.alerts=[{type:"success",msg:"Producto creado correctamente."}],o(i,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo"}]})},e.closeAlert=function(t){e.alerts.splice(t,1)}}]),e.controller("DetailUserController",["$rootScope","$scope","$stateParams","UsersService","$location","$modal","$timeout","resolveUser","$state","config","$q",function(e,t,r,n,o,a,s,i,c,l,u){var d=i.data;delete d.password,d.newPassword="",t.user=angular.copy(d),t.userID=r.userID,r.userID!=e.currentUserID&&c.go("noAuth"),n.getRoles().then(function(e){t.roles=e.data}),t.getUser=function(){n.getUser(t.userID).then(function(e){t.user=e.data,t.user.rol="",t.user.newPassword="",n.getRol(t.user.userRol).then(function(e){t.user.rol=e.data.userRol,d.rol=e.data.userRol,delete t.user.password})})},t.getUser();var g=function(){c.go(c.$current,null,{reload:!0})};t.editUser=function(){""!==t.user.newPassword&&t.user.newPassword!==!1&&(t.user.password=t.user.newPassword),u.all([n.editUser(t.user),n.saveUserImage(t.tempFile.id,t.userID)]).then(function(e){e?(t.alerts=[{type:"success",msg:"Usuario editado correctamente."}],s(g,1e3)):t.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},t.originalEditForm=function(){return angular.equals(d,t.user)},t.closeAlert=function(e){t.alerts.splice(e,1)},t.deleteUser=function(){t.modalInstance=a.open({templateUrl:"deleteUserModal.html",scope:t,controller:"UsersController"}),t["delete"]=function(){n.deleteUser(r.userID).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Usuario eliminado correctamente."}],s(t.closeAlert,4e3),c.go("usuarios")})}},t.cancel=function(){t.modalInstance.close()},t.url=l.domain+l.imagePath,n.getUserImage(t.userID).then(function(e){t.tempFile=[],angular.forEach(e.data,function(r){
e.data.length>0?(t.files=r,t.tempFile.name=r.url,t.tempFile.id=r.id,t.tempFile.src=r.url):(t.files=!1,t.image=!1)})}),t.deleteUserImage=function(e){t.imageID=e,t.modalInstance=a.open({templateUrl:"deleteImageModal.html",scope:t}),t.deleteImage=function(e){n.deleteUserImage(e).then(function(e){t.modalInstance.dismiss(),t.tempFile.name=null,t.tempFile.id=null,t.tempFile.src=null,t.files=!1,t.originalEditForm=function(){return angular.equals(d,t.user)},t.alerts=[{type:"success",msg:"Imagen eliminada correctamente."}],s(t.closeAlert,2e3)})}},t.onFileSelect=function(e){t.tempFile=[];var r=e[0];return t.tempFile.name="",r.type.indexOf("image")==-1?(t.error="Tipo de archivo no permitido. Sólo se admiten .jpg o .png",t.files=!1,!1):r.size>10485760?(t.error="El tamaño máximo permitido son 10MB",t.files=!1,!1):void n.uploadUserImage(r).progress(function(e){t.loading=parseInt(100*e.loaded/e.total)}).success(function(e){t.tempFile.name=r.name,t.tempFile.id=e.data,t.tempFile.src=e.src,t.files=!0,t.error=!1,t.originalEditForm=!1}).error(function(e){t.message=e})}}])}(),function(){var e=angular.module("projectsController",["clientsService","projectsService","usersService","ngMessages","ui.bootstrap","ui.select"]);e.controller("ProjectsController",["$scope","$modal","$timeout","$stateParams","ClientsService","ProjectsService","config",function(e,t,r,n,o,a,s){e.predicate="end_date",e.maxPages=s.maxPages,e.itemsPerPage=s.itemsPerPage,n.clientID?(e.clientID=n.clientID,o.getClient(e.clientID).then(function(t){e.clientName=t.data.name})):e.clientID=null,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.getProjects=function(t,r){a.getProjects(e.clientID,e.itemsPerPage,e.offset,t,r).then(function(t){e.projects=t.data.data,e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1),angular.forEach(e.projects,function(e){o.getClient(e.client_id).then(function(t){e.client=t.data.name})})})},e.getProjects(),e.deleteProject=function(n){e.projectID=n,e.modalInstance=t.open({templateUrl:"deleteProjectModal.html",scope:e,controller:"ProjectsController"}),e["delete"]=function(t){a.deleteProject(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Proyecto eliminado correctamente."}],r(e.closeAlert,4e3),e.getProjects()})}},e.hourWarning=function(e){return parseFloat(e.hours_total)>parseFloat(e.hours_budget)?"label-danger":parseFloat(e.hours_total)<parseFloat(e.hours_budget)&&parseFloat(e.hours_total)-parseFloat(e.hours_total/10)<=parseFloat(e.hours_budget)&&parseFloat(e.hours_total)>parseFloat(e.hours_budget)-parseFloat(e.hours_budget/10)?"label-warning":"label-standart"},e.today=new Date,e.dateWarning=function(t){if(1===t.status){var r=new Date(t.end_date);return r.getTime()<=e.today.getTime()?"label-danger":r.getTime()>e.today.getTime()&&r.getTime()-1296e6<=e.today.getTime()?"label-warning":"label-standart"}return"label-standart"},e.changeStatus=function(t,r){var n={};n.id=t,n.status=0===r?1:0,a.setProjectStatus(n).then(function(t){e.getProjects()})},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)},e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getProjects()}}]),e.controller("DetailProjectsController",["$rootScope","$scope","$stateParams","ProjectsService","$modal","$timeout","resolveProject","$state",function(e,t,r,n,o,a,s,i){var c=s.data;t.project=angular.copy(c),t.projectID=r.projectID,n.getProject(r.projectID).then(function(e){t.project=e.data});var l=function(){i.go("proyectos")},u=new Date;t.timezoneOffset=u.getTimezoneOffset()/60,t.editProject=function(){n.editProject(t.project).then(function(e){1===e.data.status?(t.alerts=[{type:"success",msg:"Proyecto editado correctamente."}],a(l,1e3)):t.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},t.originalEditForm=function(){return angular.equals(c,t.project)},t.closeAlert=function(e){t.alerts.splice(e,1)},t.deleteProject=function(){t.modalInstance=o.open({templateUrl:"deleteProjectModal.html",scope:t,controller:"ProjectsController"}),t["delete"]=function(){n.deleteProject(r.projectID).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Proyecto eliminado correctamente."}],a(t.closeAlert,4e3),i.go("proyectos")})}},t.predicate="-date",t.getTasks=function(){n.getTasks(t.projectID).then(function(e){t.tasks=e.data.data})},t.getTasks(),t.insertTime=function(r){t.taskID=r,t.modalInstance=o.open({templateUrl:"inserTimeModal.html",scope:t,controller:"TasksListController"}),t.alerts=[],t.insert=function(r){r.task_id=t.taskID,r.user=e.currentUserID,n.addTaskTime(r).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Horas apuntadas."}],a(t.closeAlert,1e3),t.getTasks()})}},t.changeStatus=function(e,r){var o={};o.id=e,o.status=0===r?1:0,n.setTaskStatus(o).then(function(e){t.getTasks()})},t.deleteTask=function(e){t.taskID=e,t.modalInstance=o.open({templateUrl:"deleteTaskModal.html",scope:t,controller:"TasksListController"}),t.deleteTaskMod=function(e){n.deleteTask(e).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Tarea eliminada correctamente."}],a(t.closeAlert,4e3),t.getTasks()})}},t.cancel=function(){t.modalInstance.close()}}]),e.controller("AddProjectController",["$scope","ClientsService","ProjectsService","$timeout","$state","$stateParams","$filter",function(e,t,r,n,o,a,s){t.getClients().then(function(t){e.clients=t.data.data,e.selected={},a.clientID&&(e.clientID=a.clientID,s("filter")(e.clients,function(t){e.clientID==t.id&&(e.selected={value:e.clients[e.clients.indexOf(t)]})}))});var i=new Date;e.timezoneOffset=i.getTimezoneOffset()/60,e.addProject=function(){e.project.client_id=e.selected.value.id;var t=function(){a.clientID?o.go("proyectos",{clientID:a.clientID}):o.go("proyectos")};r.addProject(e.project).then(function(r){1===r.data.status?(e.alerts=[{type:"success",msg:"Proyecto creado correctamente."}],n(t,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},e.closeAlert=function(t){e.alerts.splice(t,1)}}]),e.controller("TasksListController",["$rootScope","$scope","$stateParams","$modal","$state","$timeout","ProjectsService","config",function(e,t,r,n,o,a,s,i){t.state=o.current.name,t.projectID=r.projectID,t.clientID=r.clientID,t.selectedItem="",t.predicate="-date",t.maxPages=i.maxPages,t.itemsPerPage=i.itemsPerPage,t.currentPage=1,t.offset=t.itemsPerPage*(t.currentPage-1),t.paginator=!0,t.taskType=[{value:0,name:"Asignadas"},{value:1,name:"Creadas"}],t.projectID?t.getTasks=function(){s.getTasks(t.projectID,t.itemsPerPage,t.offset).then(function(e){t.tasks=e.data.data,t.results=e.data.length,t.results?t.noResults=!1:t.noResults=!0,t.results<=t.itemsPerPage&&(t.paginator=!1)})}:t.clientID?t.getTasks=function(){s.getClientAllTasks(t.clientID,t.itemsPerPage,t.offset).then(function(e){t.tasks=e.data.data,t.results=e.data.length,t.results?t.noResults=!1:t.noResults=!0,t.results<=t.itemsPerPage&&(t.paginator=!1)})}:t.getTasks=function(r){s.getUserTasks(e.currentUserID,t.itemsPerPage,t.offset,r).then(function(e){t.tasks=e.data.data,t.results=e.data.length,t.results?t.noResults=!1:t.noResults=!0,t.results<=t.itemsPerPage?t.paginator=!1:t.paginator=!0})},t.getTasks(),t.insertTime=function(r){t.taskID=r,t.modalInstance=n.open({templateUrl:"inserTimeModal.html",scope:t,controller:"TasksListController"}),t.alerts=[],t.insert=function(r){r.task_id=t.taskID,r.user=e.currentUserID,s.addTaskTime(r).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Horas apuntadas."}],a(t.closeAlert,1e3)})}},t.deleteTask=function(e){t.taskID=e,t.modalInstance=n.open({templateUrl:"deleteTaskModal.html",scope:t,controller:"TasksListController"}),t["delete"]=function(e){s.deleteTask(e).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Tarea eliminada correctamente."}],a(t.closeAlert,4e3),t.getTasks()})}},t.changeStatus=function(e,r){var n={};n.id=e,n.status=0===r?1:0,s.setTaskStatus(n).then(function(e){t.getTasks()})},t.cancel=function(){t.modalInstance.close()},t.closeAlert=function(e){t.alerts.splice(e,1)},t.pageChanged=function(){t.offset=t.itemsPerPage*(t.currentPage-1),t.getTasks(t.selectedItem)},t.selectedItem=0,t.updateTaskList=function(){t.getTasks(t.selectedItem)}}]),e.controller("TasksListMenuController",["$scope","$stateParams",function(e,t){e.projectID=t.projectID}]),e.controller("DetailTaskController",["$rootScope","$scope","$stateParams","ProjectsService","UsersService","$modal","$timeout","resolveTask","$state","$filter",function(e,t,r,n,o,a,s,i,c,l){var u=i.data;t.task=angular.copy(u),t.taskID=r.taskID,n.getTask(t.taskID).then(function(e){t.task=e.data}),o.getUsers().then(function(e){t.users=e.data.data;var r=l("filter")(t.users,function(e){return e.id==t.task.assigned})[0];t.selected={value:r}}),t.getTaskTime=function(){n.getTaskTime(t.taskID).then(function(e){t.hours=e.data.data,t.totalTime=e.data.totalTime})},t.getTaskTime(),t.selectChange=function(){t.task.assigned=t.selected.value.id};var d=function(){c.go("listadoTareas",{projectID:t.task.project_id})};t.editTask=function(){n.editTask(t.task).then(function(e){1===e.data.status?(t.alerts=[{type:"success",msg:"Tarea editada correctamente."}],s(d,1e3)):t.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},t.originalEditForm=function(){return angular.equals(u,t.task)},t.closeAlert=function(e){t.alerts.splice(e,1)},t.deleteTask=function(){t.modalInstance=a.open({templateUrl:"deleteTaskModal.html",scope:t,controller:"TasksListMenuController"}),t["delete"]=function(){n.deleteTask(t.taskID).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Tarea eliminada correctamente."}],s(t.closeAlert,4e3),d()})}},t.enable=function(){var r=["0","1","2"];(r.indexOf(e.userRol)>-1||t.task.marker==e.currentUserID)&&(t.disabled=!0)},t.enableText=function(){var r=["0","1","2"];(r.indexOf(e.userRol)>-1||t.task.marker==e.currentUserID)&&(t.nowrite=!0)},t.insertTime=function(r){t.modalInstance=a.open({templateUrl:"inserTimeModal.html",scope:t,controller:"TasksListController"}),t.alerts=[],t.insert=function(o){o.task_id=t.taskID,o.user=e.currentUserID,n.addTaskTime(o).then(function(e){t.modalInstance.dismiss(),t.alerts=[{type:"success",msg:"Horas apuntadas."}],s(t.closeAlert,1e3),r?c.go(c.current,{},{reload:!0}):t.getTaskTime()})}},t.allow=function(){var r=["0","1"];(r.indexOf(e.userRol)>-1||t.task.marker==e.currentUserID)&&(t.allowed=!0)},t.allow(),t.cancel=function(){t.modalInstance.close()}}]),e.controller("AddTaskController",["$rootScope","$scope","$stateParams","ProjectsService","UsersService","$timeout","$state",function(e,t,r,n,o,a,s){t.projectID=r.projectID,r.clientID&&(t.clientID=r.clientID,n.getProjects(t.clientID).then(function(e){t.projects=e.data.data,t.selectedProj={}})),t.task={status:!0,maker:e.currentUserID,project_id:t.projectID},o.getUsers().then(function(e){t.users=e.data.data,t.selected={}}),t.addTask=function(){r.clientID&&(t.task.project_id=t.selectedProj.value.id),t.task.assigned=t.selected.value.id;var e=function(){s.go("proyectosDetalle",{projectID:t.projectID})};n.addTask(t.task).then(function(r){1===r.data.status?(t.alerts=[{type:"success",msg:"Tarea creada correctamente."}],a(e,1e3)):t.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})}}])}(),function(){var e=angular.module("expensesController",["usersService","expensesService"]);e.controller("ListExpensesController",["$scope","UsersService","ExpensesService","config","$modal","$timeout","$state",function(e,t,r,n,o,a,s){e.maxPages=n.maxPages,e.itemsPerPage=n.itemsPerPage,e.currentPage=1,e.offset=e.itemsPerPage*(e.currentPage-1),e.paginator=!0,e.predicate="-date",e.getExpenses=function(){"listadoGastosRecurrentes"==s.current.name?r.getExpensesRecurrent(e.itemsPerPage,e.offset).then(function(t){e.expenses=t.data.data,e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)}):r.getExpenses(e.itemsPerPage,e.offset).then(function(t){e.expenses=t.data.data,e.results=t.data.length,e.results<=e.itemsPerPage&&(e.paginator=!1)})},e.getExpenses(),e.state=s.current.name;var i=new Date;e.timezoneOffset=i.getTimezoneOffset()/60,e.editExpenses=function(n){"listadoGastosRecurrentes"==e.state?r.getExpenseRecurrent(n).then(function(n){e.expense=n.data,e.selected={},t.getUsers().then(function(t){e.users=t.data.data,angular.forEach(e.users,function(t){t.id==e.expense.user_id&&(e.selected.value=t)}),e.selected.value||(e.selected={value:e.users[e.users.length-1]})}),r.getExpensesFrequency().then(function(t){e.frequency=t.data.data})}):r.getExpense(n).then(function(n){e.expense=n.data,e.selected={},t.getUsers().then(function(t){e.users=t.data.data,angular.forEach(e.users,function(t){t.id==e.expense.user_id&&(e.selected.value=t)}),e.selected.value||(e.selected={value:e.users[e.users.length-1]})}),r.getExpensesFrequency().then(function(t){e.frequency=t.data.data})}),e.modalInstance=o.open({templateUrl:"editExpensesModal.html",scope:e,controller:"ListExpensesController"}),e.alerts=[],e.edit=function(t){t.user_id=e.selected.value.id,"listadoGastosRecurrentes"==e.state?r.editExpensesRecurrent(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Gasto editado correctamente."}],e.getExpenses(),a(e.closeAlert,4e3)}):r.editExpenses(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Gasto editado correctamente."}],e.getExpenses(),a(e.closeAlert,4e3)})}},e.deleteExpenses=function(t){e.expensesID=t,e.modalInstance=o.open({templateUrl:"deleteExpensesModal.html",scope:e,controller:"ListExpensesController"}),e["delete"]=function(t){"listadoGastosRecurrentes"==e.state?r.deleteExpensesRecurrent(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Gasto eliminado correctamente."}],a(e.closeAlert,4e3),e.getExpenses()}):r.deleteExpenses(t).then(function(t){e.modalInstance.dismiss(),e.alerts=[{type:"success",msg:"Gasto eliminado correctamente."}],a(e.closeAlert,4e3),e.getExpenses()})}},e.cancel=function(){e.modalInstance.close()},e.closeAlert=function(t){e.alerts.splice(t,1)},e.pageChanged=function(){e.offset=e.itemsPerPage*(e.currentPage-1),e.getExpenses()}}]),e.controller("AddExpensesController",["$scope","UsersService","ExpensesService","$timeout","$state",function(e,t,r,n,o){t.getUsers().then(function(t){e.users=t.data.data,e.selected={}}),r.getExpensesFrequency().then(function(t){e.frequency=t.data.data});var a=new Date;e.timezoneOffset=a.getTimezoneOffset()/60,e.addExpenses=function(){e.expenses.user_id=e.selected.value.id;var t=function(){o.go("listadoGastos")};r.addExpenses(e.expenses).then(function(r){console.log(r),1==r.data.status?(e.alerts=[{type:"success",msg:"Gasto insertado correctamente."}],n(t,1e3)):e.alerts=[{type:"danger",msg:"Se ha producido un error, por favor vuelve a intentarlo."}]})},e.closeAlert=function(t){e.alerts.splice(t,1)}}])}(),function(){var e=angular.module("clientsService",[]);e.factory("ClientsService",["$http","$location",function(e,t){var r="http://app.fiadeiro.es/webservice/",n=[];return n.getClients=function(t,n){return"undefined"==typeof t||"undefined"==typeof n?e.get(r+"getClients"):e.get(r+"getClients?perPage="+t+"&offset="+n)},n.getClient=function(t){return e.get(r+"getClient?id="+t)},n.addClient=function(t){return e.post(r+"addClient",t)},n.editClient=function(t){return e.put(r+"editClient",t).then(function(e){return e})},n.deleteClient=function(t){return e["delete"](r+"deleteClient?id="+t).then(function(e){return e.data})},n.getProvinces=function(){return e.get(r+"getProvinces")},n.getProvince=function(t){return e.get(r+"getProvince?id="+t)},n.addComment=function(t){return e.post(r+"addComment",t)},n.getComments=function(t){return e.get(r+"getComments?clientID="+t)},n.getClientTasks=function(t){return e.get(r+"getClientTasks?clientID="+t)},n}])}(),function(){var e=angular.module("productsService",[]);e.factory("ProductsService",["$http","$location","$upload",function(e,t,r){var n="http://app.fiadeiro.es/webservice/",o=[];return o.getRootFamilies=function(t,r){return e.get(n+"getRootFamilies?perPage="+t+"&offset="+r)},o.getFamilies=function(t,r,o){return"undefined"==typeof r||"undefined"==typeof o?e.get(n+"getFamilies?id="+t):e.get(n+"getFamilies?id="+t+"&perPage="+r+"&offset="+o)},o.getFinalFamilies=function(t,r,o){return"undefined"==typeof r||"undefined"==typeof o?e.get(n+"getFinalFamilies?id="+t):e.get(n+"getFinalFamilies?id="+t+"&perPage="+r+"&offset="+o)},o.getProducts=function(t,r,o){return"undefined"==typeof r||"undefined"==typeof o?t?e.get(n+"getProducts?familyID="+t):e.get(n+"getProducts"):t?e.get(n+"getProducts?familyID="+t+"&perPage="+r+"&offset="+o):e.get(n+"getProducts?perPage="+r+"&offset="+o)},o.getProduct=function(t){return e.get(n+"getProduct?id="+t)},o.getProductPrice=function(t){return e.get(n+"getProductPrice?id="+t)},o.getProductImage=function(t){return e.get(n+"getProductImage?id="+t)},o.getVAT=function(){return e.get(n+"getVAT")},o.addProduct=function(t){return e.post(n+"addProduct",t)},o.addFormat=function(t){return e.post(n+"addFormat",t)},o.editProduct=function(t){return e.put(n+"editProduct",t).then(function(e){return e})},o.editFormat=function(t){return e.put(n+"editFormat",t).then(function(e){return e})},o.deleteFormat=function(t){return e["delete"](n+"deleteFormat",{data:t}).then(function(e){return e})},o.deleteProduct=function(t){return e["delete"](n+"deleteProduct?id="+t).then(function(e){return e.data})},o.uploadProductImage=function(e){return r.upload({url:n+"uploadProductImage",method:"POST",file:e,data:e.name})},o.deleteProductImage=function(t){return e["delete"](n+"deleteProductImage?id="+t).then(function(e){return e})},o.saveProductImage=function(t,r){return e.post(n+"saveProductImage",{id:t,productID:r}).then(function(e){return e})},o.getProductImage=function(t){return e.get(n+"getProductImage?id="+t).then(function(e){return e})},o}])}(),function(){var e=angular.module("ordersService",[]);e.factory("OrdersService",["$http","$location",function(e,t){var r="http://app.fiadeiro.es/webservice/",n=[];return n.data={units:"",view:"",save:!1},n.getView=function(){return n.data.view},n.setView=function(e){return n.data.view=e,n.data.view},n.getProducts=function(t,n,o){return"undefined"==typeof n||"undefined"==typeof o?t?e.get(r+"getProducts?order=1&familyID="+t):e.get(r+"getProducts?order=1"):t?e.get(r+"getProducts?order=1&familyID="+t+"&perPage="+n+"&offset="+o):e.get(r+"getProducts?order=1&perPage="+n+"&offset="+o)},n.getProductUnits=function(){return n.data.units},n.setProductUnits=function(e){return n.data.units=e,n.data.units},n.getSaveMode=function(){return n.data.save},n.setSaveMode=function(e){return n.data.save=e,n.data.save},n.getPrice=function(t){return e.get(r+"getPrice?id="+t)},n.getVAT=function(){return e.get(r+"getVAT")},n.getVATPercent=function(t){return e.get(r+"getVATPercent?id="+t)},n.addOrder=function(t){return e.post(r+"addOrder",t)},n.addOrderLines=function(t,n){return e.post(r+"addOrderLines",{products:t,orderID:n}).then(function(e){return e})},n.editOrder=function(t){return e.put(r+"editOrder",t)},n.editOrderLines=function(t,n){return e.put(r+"editOrderLines",{products:t,orderID:n}).then(function(e){return e})},n.getOrder=function(t){return e.get(r+"getOrder?id="+t)},n.getOrderLines=function(t){return e.get(r+"getOrderLines?id="+t).then(function(e){return angular.forEach(e.data,function(e){e.units=parseInt(e.units)}),e})},n.getOrders=function(t,n,o,a){return t?e.get(r+"getOrders?clientID="+t+"&perPage="+n+"&offset="+o+"&type="+a):e.get(r+"getOrders?perPage="+n+"&offset="+o+"&type="+a)},n.deleteOrder=function(t){return e["delete"](r+"deleteOrder?id="+t).then(function(e){return e.data})},n.acceptOrder=function(t,n){return e.put(r+"acceptOrder",{order:t,project:n})},n.getInvoices=function(t,n,o,a,s){return t?n?e.get(r+"getInvoices?clientID="+t+"&orderID="+n+"&perPage="+o+"&offset="+a+"&type="+s):e.get(r+"getInvoices?clientID="+t+"&perPage="+o+"&offset="+a+"&type="+s):n?e.get(r+"getInvoices?orderID="+n+"&perPage="+o+"&offset="+a+"&type="+s):e.get(r+"getInvoices?perPage="+o+"&offset="+a+"&type="+s)},n.getInvoice=function(t){return e.get(r+"getInvoice?id="+t).then(function(e){return e.data.date=new Date(e.data.date),e})},n.deleteInvoice=function(t){return e["delete"](r+"deleteInvoice?id="+t).then(function(e){return e.data})},n.invoiceChangeStatus=function(t,n){return e.post(r+"invoiceChangeStatus",{invoiceID:t,status:n})},n.addInvoice=function(t){return e.post(r+"addInvoice",t)},n.editInvoice=function(t){return e.put(r+"editInvoice",t)},n.getPaymentMethods=function(){return e.get(r+"getPaymentMethods")},n.getInstallments=function(){return e.get(r+"getInstallments")},n}])}(),function(){var e=angular.module("familiesService",[]);e.factory("FamiliesService",["$http","$location",function(e,t){var r="http://app.fiadeiro.es/webservice/",n=[];return n.getFamily=function(t){return e.get(r+"getFamily?id="+t)},n.getRootFamilies=function(){return e.get(r+"getRootFamilies")},n.getFamilies=function(t){return e.get(r+"getFamilies?id="+t)},n.addFamily=function(t){return e.post(r+"addFamily",t)},n.editFamily=function(t){return e.put(r+"editFamily",t)},n.deleteFamily=function(t){return e["delete"](r+"deleteFamily?id="+t).then(function(e){return e.data})},n}])}(),function(){var e=angular.module("loginService",["ui.bootstrap","ui.router.compat"]);e.factory("LoginService",["$http","$location","$modal","$rootScope","$window",function(e,t,r,n,o){var a="http://app.fiadeiro.es/webservice/",s=[];return s.assignCurrentUser=function(e){return n.currentUser=e,o.sessionStorage.user=e,e},s.assignCurrentUserImg=function(e){return n.currentUserImg=e,o.sessionStorage.userImg=e,e},s.assignCurrentUserID=function(e){return n.currentUserID=e,o.sessionStorage.userID=e,e},s.assingToken=function(e){return n.token=e,o.sessionStorage.token=e,e},s.assingUserRol=function(e){return n.userRol=e,o.sessionStorage.userRol=e,e},s.modal=function(){var e=r.open({templateUrl:"partials/loginModal.html",controller:"LoginController",controllerAs:"LoginController"});return e.result.then(function(e){s.assignCurrentUser(e.data.username),s.assignCurrentUserImg(e.data.url),s.assignCurrentUserID(e.data.id),s.assingToken(e.token),s.assingUserRol(e.data.userRol)})},s.login=function(t,r){return e.post(a+"login",{username:t,password:r}).then(function(e){return e.data})},s}])}(),function(){var e=angular.module("configService",[]);e.factory("ConfigService",["$http","$location","$upload",function(e,t,r){var n="http://app.fiadeiro.es/webservice/",o=[];return o.deleteVat=function(t){return e["delete"](n+"deleteVat?id="+t).then(function(e){return e.data})},o.addVat=function(t){return e.post(n+"addVat",t).then(function(e){return e})},o.getUserData=function(){return e.get(n+"getUserData")},o.editUserData=function(t){return e.put(n+"editUserData",t)},o.getInvoiceImage=function(){return e.get(n+"getInvoiceImage")},o.uploadInvoiceImage=function(e){return r.upload({url:n+"uploadInvoiceImage",method:"POST",file:e,data:e.name})},o.deleteInvoiceImage=function(t){return e["delete"](n+"deleteInvoiceImage").then(function(e){return e})},o}])}(),function(){var e=angular.module("usersService",[]);e.factory("UsersService",["$http","$location","$upload",function(e,t,r){var n="http://app.fiadeiro.es/webservice/",o=[];return o.getUsers=function(t,r){return"undefined"==typeof t||"undefined"==typeof r?e.get(n+"getUsers"):e.get(n+"getUsers?perPage="+t+"&offset="+r)},o.getUser=function(t){return e.get(n+"getUser?id="+t)},o.addUser=function(t){return e.post(n+"addUser",t).then(function(e){return e})},o.editUser=function(t){return e.put(n+"editUser",t).then(function(e){return e})},o.deleteUser=function(t){return e["delete"](n+"deleteUser?id="+t).then(function(e){return e.data})},o.getRoles=function(){return e.get(n+"getRoles")},o.getRol=function(t){return e.get(n+"getRol?id="+t)},o.uploadUserImage=function(e,t){return r.upload({url:n+"uploadUserImage",method:"POST",file:e,data:e.name})},o.saveUserImage=function(t,r){return e.post(n+"saveUserImage",{id:t,userID:r}).then(function(e){return e})},o.deleteUserImage=function(t){return e["delete"](n+"deleteUserImage?id="+t).then(function(e){return e})},o.getUserImage=function(t){return e.get(n+"getUserImage?id="+t).then(function(e){return e})},o}])}(),function(){var e=angular.module("projectsService",[]);e.factory("ProjectsService",["$http",function(e){var t="http://app.fiadeiro.es/webservice/",r=[];return r.getProjects=function(r,n,o,a,s){return"undefined"==typeof n||"undefined"==typeof o?r?e.get(t+"getProjects?clientID="+r+"&orderBy="+a+"&orderWay="+s):e.get(t+"getProjects?orderBy="+a+"&orderWay="+s):r?e.get(t+"getProjects?clientID="+r+"&perPage="+n+"&offset="+o+"&orderBy="+a+"&orderWay="+s):e.get(t+"getProjects?perPage="+n+"&offset="+o+"&orderBy="+a+"&orderWay="+s)},r.getActiveProjects=function(r,n,o){return"undefined"==typeof n||"undefined"==typeof o?r?e.get(t+"getActiveProjects?clientID="+r):e.get(t+"getActiveProjects"):r?e.get(t+"getActiveProjects?clientID="+r+"&perPage="+n+"&offset="+o):e.get(t+"getActiveProjects?perPage="+n+"&offset="+o)},r.getProject=function(r){return e.get(t+"getProject?id="+r).then(function(e){return e.data.hours_budget=parseFloat(e.data.hours_budget),e.data.end_date=new Date(e.data.end_date),e})},r.addProject=function(r){return e.post(t+"addProject",r)},r.editProject=function(r){return e.put(t+"editProject",r).then(function(e){return e})},r.setProjectStatus=function(r){return e.post(t+"setProjectStatus",r).then(function(e){return e})},r.deleteProject=function(r){return e["delete"](t+"deleteProject?id="+r).then(function(e){return e.data})},r.getTasks=function(r,n,o){return"undefined"==typeof n||"undefined"==typeof o?e.get(t+"getTasks?projectID="+r).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e}):e.get(t+"getTasks?projectID="+r+"&perPage="+n+"&offset="+o).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e})},r.getClientAllTasks=function(r,n,o){return"undefined"==typeof n||"undefined"==typeof o?e.get(t+"getClientAllTasks?clientID="+r).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e}):e.get(t+"getClientAllTasks?clientID="+r+"&perPage="+n+"&offset="+o).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e})},r.getUserTasks=function(r,n,o,a){return"undefined"==typeof n||"undefined"==typeof o?e.get(t+"getUserTasks?userID="+r+"&type="+a).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e}):e.get(t+"getUserTasks?userID="+r+"&type="+a+"&perPage="+n+"&offset="+o).then(function(e){return angular.forEach(e.data.data,function(e){e.hours_budget=parseFloat(e.hours_budget),e.hours_cons=parseFloat(e.hours_cons)}),e})},r.getTask=function(r){return e.get(t+"getTask?id="+r).then(function(e){return e.data.hours_budget=parseFloat(e.data.hours_budget),e})},r.addTask=function(r){return e.post(t+"addTask",r)},r.deleteTask=function(r){return e["delete"](t+"deleteTask?id="+r).then(function(e){return e.data})},r.addTaskTime=function(r){return e.post(t+"addTaskTime",r)},r.editTask=function(r){return e.put(t+"editTask",r).then(function(e){return e})},r.setTaskStatus=function(r){return e.post(t+"setTaskStatus",r).then(function(e){return e})},r.getTaskTime=function(r){return e.get(t+"getTaskTime?id="+r)},r}])}(),function(){var e=angular.module("graphicsService",[]);e.factory("GraphicsService",["$http","$location","$upload",function(e,t){var r="http://app.fiadeiro.es/webservice/",n=[];return n.getProjectsByYear=function(t){return e.get(r+"getProjectsByYear?year="+t)},n.getLastYearProjects=function(){return e.get(r+"getLastYearProjects")},n.getAcceptedOrdersAmountByYear=function(t){return e.get(r+"getAcceptedOrdersAmountByYear?year="+t)},n.getLastYearAcceptedOrdersAmount=function(){return e.get(r+"getLastYearAcceptedOrdersAmount")},n.getPayedInvoicesAmountByYear=function(t){return e.get(r+"getPayedInvoicesAmountByYear?year="+t)},n.getLastYearPayedInvoicesAmount=function(){return e.get(r+"getLastYearPayedInvoicesAmount")},n.getLastYearExpenses=function(){return e.get(r+"getLastYearExpenses")},n.getExpensesByYear=function(t){return e.get(r+"getExpensesByYear?year="+t)},n.getSentInvoicesCount=function(){return e.get(r+"getSentInvoicesCount")},n.getActiveProjectsCount=function(){return e.get(r+"getActiveProjectsCount")},n.getActiveTasksCount=function(){return e.get(r+"getActiveTasksCount")},n.getSentOrdersCount=function(){return e.get(r+"getSentOrdersCount")},n.getMonthInvoicesAmount=function(){return e.get(r+"getMonthInvoicesAmount")},n.getMonthExpenses=function(){return e.get(r+"getMonthExpenses")},n}])}(),function(){var e=angular.module("expensesService",[]);e.factory("ExpensesService",["$http",function(e){var t="http://app.fiadeiro.es/webservice/",r=[];return r.getExpenses=function(r,n){return"undefined"==typeof r||"undefined"==typeof n?e.get(t+"getExpenses"):e.get(t+"getExpenses?perPage="+r+"&offset="+n)},r.getExpensesRecurrent=function(r,n){return"undefined"==typeof r||"undefined"==typeof n?e.get(t+"getExpensesRecurrent"):e.get(t+"getExpensesRecurrent?perPage="+r+"&offset="+n)},r.getExpense=function(r){return e.get(t+"getExpense?id="+r).then(function(e){return e.data.amount=parseFloat(e.data.amount),e.data.date=new Date(e.data.date),e})},r.getExpenseRecurrent=function(r){return e.get(t+"getExpenseRecurrent?id="+r).then(function(e){return e.data.amount=parseFloat(e.data.amount),e.data.date=new Date(e.data.date),e})},r.getExpensesFrequency=function(){return e.get(t+"getExpensesFrequency")},r.addExpenses=function(r){return e.post(t+"addExpenses",r).then(function(e){return e})},r.editExpenses=function(r){return e.put(t+"editExpenses",r).then(function(e){return e})},r.deleteExpenses=function(r){return e["delete"](t+"deleteExpenses?id="+r).then(function(e){return e.data})},r.editExpensesRecurrent=function(r){return e.put(t+"editExpensesRecurrent",r).then(function(e){return e})},r.deleteExpensesRecurrent=function(r){return e["delete"](t+"deleteExpensesRecurrent?id="+r).then(function(e){return e.data})},r}])}(),function(){var e=angular.module("commaDirective",[]);e.directive("comaDotConverter",function(){return{require:"ngModel",link:function(e,t,r,n){n.$parsers.push(function(e){if("undefined"==typeof e)return"";var t=e.replace(/,/g,".");return t!=e&&(n.$setViewValue(t),n.$render()),t})}}})}(),function(){var e=angular.module("recursiveFamilies",[]);e.directive("recursiveFamilies",["FamiliesService","$stateParams",function(e,t){return{restrict:"EA",scope:{familia:"="},template:'<li ng-repeat="family in childFamilies"><form class="form"><label ng-bind="family.name"></label></form></li>',link:function(t,r,n){angular.forEach(familia,function(t){e.getFamilies(t.id).then(function(e){$scope.template="",$scope.childFamilies=e.data})})}}}])}(),function(){var e=angular.module("inputEnable",[]);e.directive("inputEnable",["$rootScope",function(e){return{restrict:"A",link:function(t,r,n){e.userRol<=1&&(r.bind("click",function(){this.readOnly=!1}),r.bind("blur",function(){this.readOnly=!0}),r.bind("keyup",function(){}))}}}])}(),function(){var e=angular.module("setFocus",[]);e.directive("setFocus",function(){return{scope:{trigger:"=setFocus"},link:function(e,t){e.$watch("trigger",function(r){r===!0&&(t[0].focus(),e.trigger=!1)})}}})}(),function(){var e=angular.module("passwordCheck",[]);e.directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(e,t,r,n){e.$watch(function(){var t;
return(e.passwordVerify||n.$viewValue)&&(t=e.passwordVerify+"_"+n.$viewValue),t},function(t){t&&n.$parsers.unshift(function(t){var r=e.passwordVerify;return r!==t?void n.$setValidity("passwordVerify",!1):(n.$setValidity("passwordVerify",!0),t)})})}}})}(),function(){var e=angular.module("hitEnter",[]);e.directive("hitEnter",function(){return{restrict:"A",link:function(e,t,r){document.addEventListener("keydown",function(t){13===t.which&&(e.$apply(function(){e.$eval(r.hitEnter)}),t.preventDefault())})}}})}(),function(){var e=angular.module("dateConverterFilter",[]);e.filter("dateToISO",function(){return function(e){return new Date(e).toISOString()}})}();